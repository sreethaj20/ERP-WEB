import{F as r,E as e}from"./vendor-AZjfysqh.js";import{u as B}from"./index-CcBKZM2H.js";import{L as G}from"./router-CieCW4vl.js";const $=i=>`${i.getFullYear()}-${String(i.getMonth()+1).padStart(2,"0")}`,P=()=>$(new Date),A=(i=12)=>{const p=[],x=new Date;for(let g=0;g<i;g++){const y=new Date(x.getFullYear(),x.getMonth()-g,1);p.push($(y))}return p};function Q(){const{users:i,getRagByMonth:p,getOneOnOneByMonth:x,createRagReport:g,createOneOnOne:y}=B(),[d,_]=r.useState(P()),[M,O]=r.useState(A(12)),[w,S]=r.useState([]),[o,T]=r.useState(""),[v,C]=r.useState([]),[u,E]=r.useState("rag"),[z,K]=r.useState({email:"",status:"green",comments:""}),[Y,Z]=r.useState({email:"",comments:""});r.useEffect(()=>{O(A(12))},[]),r.useEffect(()=>{(async()=>{try{const a=await p(d);S(Array.isArray(a)?a:[])}catch{S([])}try{const a=await x(d);C(Array.isArray(a)?a:[])}catch{C([])}})()},[d,p,x]);const R=r.useMemo(()=>{const t=(a="")=>{try{const s=String(a).split("@")[0]||"";if(!s)return a||"";const c=s.replace(/[^a-zA-Z0-9._-]/g," ").split(/[._-]+/).filter(Boolean);return c.length===0?a||"":c.map(n=>n.charAt(0).toUpperCase()+n.slice(1)).join(" ")}catch{return a||""}};return w.map(a=>{const s=i.find(b=>b.email===a.email),h=s?`${s.firstName||""} ${s.lastName||""}`.trim()||s.username||s.email:a.email,c=(s==null?void 0:s.designation)||(s==null?void 0:s.position)||(s==null?void 0:s.role)||"Employee",m=(s==null?void 0:s.teamLeadEmail)||"",n=i.find(b=>(b.email||"").toLowerCase()===(m||"").toLowerCase()),k=n?`${n.firstName||""} ${n.lastName||""}`.trim()||n.username||t(n.email):t(m),j=i.find(b=>(b.email||"").toLowerCase()===(a.manager||"").toLowerCase()),V=j?`${j.firstName||""} ${j.lastName||""}`.trim()||j.username||t(j.email):t(a.manager||"");return{...a,empName:h,designation:c,teamLeadEmail:m,teamLeadName:k||V}})},[w,i]),F=r.useMemo(()=>i.filter(t=>(t.designation||"").toLowerCase()==="team lead"||(t.role||"").toLowerCase()==="manager").map(t=>({email:t.email,name:`${t.firstName||""} ${t.lastName||""}`.trim()||t.username||t.email})),[i]),L=r.useMemo(()=>{if(!o)return[];const t=o.toLowerCase();return R.filter(a=>(a.teamLeadEmail||"").toLowerCase()===t||(a.manager||"").toLowerCase()===t)},[R,o]),N=r.useMemo(()=>o?v.filter(t=>(t.manager||"").toLowerCase()===o.toLowerCase()).map(t=>{const a=i.find(c=>(c.email||"").toLowerCase()===(t.email||"").toLowerCase()),s=t.name||`${(a==null?void 0:a.firstName)||""} ${(a==null?void 0:a.lastName)||""}`.trim()||(a==null?void 0:a.username)||t.email,h=(a==null?void 0:a.designation)||(a==null?void 0:a.role)||"Employee";return{...t,empName:s,designation:h}}):[],[v,o,i]),D=()=>{if(!o){alert("Please select a Team Lead to export their reports.");return}const t=["Month","Employee Name","Email","Designation","RAG Status","Comments","Team Lead","Submitted At"],a=L.map(n=>[d,l(n.empName),l(n.email),l(n.designation),l(n.status),l(n.comments||""),l(n.teamLeadName||""),l(new Date(n.submittedAt).toLocaleString())]),s=[t.join(","),...a.map(n=>n.join(","))].join(`
`),h=new Blob(["\uFEFF"+s],{type:"text/csv;charset=utf-8;"}),c=URL.createObjectURL(h),m=document.createElement("a");m.href=c,m.download=`TeamLeadReports_${d}_${(o||"unselected").replace(/[^a-z0-9@._-]/gi,"_")}.csv`,m.click(),URL.revokeObjectURL(c)},U=()=>{if(!o){alert("Please select a Team Lead to export their reports.");return}const t=["Month","Employee Name","Email","Designation","Comments","Team Lead","Submitted At"],a=N.map(n=>[d,l(n.empName),l(n.email),l(n.designation),l(n.comments||""),l(o),l(new Date(n.submittedAt).toLocaleString())]),s=[t.join(","),...a.map(n=>n.join(","))].join(`
`),h=new Blob(["\uFEFF"+s],{type:"text/csv;charset=utf-8;"}),c=URL.createObjectURL(h),m=document.createElement("a");m.href=c,m.download=`OneOnOneReports_${d}_${(o||"unselected").replace(/[^a-z0-9@._-]/gi,"_")}.csv`,m.click(),URL.revokeObjectURL(c)},l=t=>{if(t==null)return"";const a=String(t).replace(/"/g,'""');return/[",\n]/.test(a)?`"${a}"`:a},f=t=>{const[a,s]=t.split("-");return new Date(Number(a),Number(s)-1,1).toLocaleString(void 0,{month:"long",year:"numeric"})};return e.jsxs("div",{className:"dashboard fade-in teamlead-reports-page",children:[e.jsxs("div",{className:"dashboard-header",children:[e.jsxs("div",{children:[e.jsx("h2",{children:"ðŸ‘¥ Team Lead Reports"}),e.jsx("p",{children:u==="rag"?"View manager-submitted Employee RAG reports, by month.":"View 1:1 interaction submissions, by month."})]}),e.jsx("div",{children:e.jsx(G,{className:"btn-outline",to:"/admin/reports",children:"â† Back to Reports"})})]}),e.jsxs("div",{className:"reports-toolbar",children:[e.jsxs("div",{className:"reports-toolbar__filters",children:[e.jsx("label",{className:"reports-toolbar__label",children:"Month:"}),e.jsx("select",{value:d,onChange:t=>_(t.target.value),children:M.map(t=>e.jsx("option",{value:t,children:f(t)},t))}),e.jsx("label",{className:"reports-toolbar__label",children:"Team Lead:"}),e.jsxs("select",{value:o,onChange:t=>T(t.target.value),children:[e.jsx("option",{value:"",children:"Select Team Lead"}),F.map(t=>e.jsxs("option",{value:t.email,children:[t.name," (",t.email,")"]},t.email))]}),e.jsxs("div",{className:"reports-toolbar__tabs",children:[e.jsx("button",{type:"button",className:u==="rag"?"btn-primary":"btn-outline",onClick:()=>E("rag"),children:"RAG"}),e.jsx("button",{type:"button",className:u==="oo"?"btn-primary":"btn-outline",onClick:()=>E("oo"),children:"1:1"})]})]}),e.jsxs("div",{className:"reports-toolbar__actions",children:[u==="rag"&&e.jsx("button",{className:"btn-primary",onClick:D,children:"Export to Excel (CSV)"}),u==="oo"&&e.jsx("button",{className:"btn-primary",onClick:U,children:"Export to Excel (CSV)"})]})]}),u==="rag"&&e.jsx("div",{className:"table-wrapper",children:e.jsxs("table",{className:"one-on-one-table",style:{width:"100%"},children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"Employee"}),e.jsx("th",{children:"Email"}),e.jsx("th",{children:"Designation"}),e.jsx("th",{children:"Status"}),e.jsx("th",{children:"Comments"}),e.jsx("th",{children:"Team Lead"}),e.jsx("th",{children:"Submitted At"})]})}),e.jsx("tbody",{children:L.length===0?e.jsx("tr",{children:e.jsx("td",{colSpan:7,style:{textAlign:"center"},children:o?`No RAG reports found for ${f(d)} for ${o}. Ensure submissions were made for this month and that the employee's Team Lead or the submitter matches the selected email.`:"Please select a Team Lead to view their submitted reports."})}):L.map((t,a)=>e.jsxs("tr",{children:[e.jsx("td",{children:t.empName}),e.jsx("td",{children:t.email}),e.jsx("td",{children:e.jsx("span",{className:"role-badge",children:t.designation})}),e.jsx("td",{style:{textAlign:"center"},children:t.status==="red"?"ðŸ”´ Red":t.status==="amber"?"ðŸŸ¡ Amber":t.status==="green"?"ðŸŸ¢ Green":t.status}),e.jsx("td",{children:t.comments||""}),e.jsx("td",{children:t.teamLeadName||""}),e.jsx("td",{children:new Date(t.submittedAt).toLocaleString()})]},`rag-admin-${a}`))})]})}),u==="oo"&&e.jsx("div",{className:"table-wrapper",style:{marginTop:16},children:e.jsxs("table",{className:"one-on-one-table",style:{width:"100%"},children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"Employee"}),e.jsx("th",{children:"Email"}),e.jsx("th",{children:"Designation"}),e.jsx("th",{children:"Comments"}),e.jsx("th",{children:"Submitted At"})]})}),e.jsx("tbody",{children:N.length===0?e.jsx("tr",{children:e.jsx("td",{colSpan:5,style:{textAlign:"center"},children:o?`No 1:1 interaction reports found for ${f(d)} for the selected Team Lead.`:"Please select a Team Lead to view their 1:1 interactions."})}):N.map((t,a)=>e.jsxs("tr",{children:[e.jsx("td",{children:t.empName}),e.jsx("td",{children:t.email}),e.jsx("td",{children:e.jsx("span",{className:"role-badge",children:t.designation})}),e.jsx("td",{children:t.comments||""}),e.jsx("td",{children:new Date(t.submittedAt).toLocaleString()})]},`oo-admin-${a}`))})]})})]})}export{Q as default};

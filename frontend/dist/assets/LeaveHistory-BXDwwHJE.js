import{L as C,F as l,E as e}from"./vendor-AZjfysqh.js";import{f as p}from"./date-DAJMpUuB.js";import{g as _}from"./holidays-BHBlvUOY.js";import{u as I}from"./index-CcBKZM2H.js";import"./router-CieCW4vl.js";function V(){const{currentUser:r,getMyLeaves:b,getMyLeaveBalance:Y}=I(),L=C(),[g,x]=l.useState([]),[d,N]=l.useState(0),[k,w]=l.useState(18),[E,D]=l.useState(18),[y,f]=l.useState("history"),v=new Date,F=v.toLocaleString("default",{month:"long"}),M=_(v.getFullYear(),v.getMonth()),c=1.5;l.useEffect(()=>{A(),S()},[r]),l.useEffect(()=>{new URLSearchParams(L.search||"").get("section")==="holidays"&&f("holidays")},[L.search]),l.useEffect(()=>{const t=setInterval(()=>{S(),A()},5e3);return()=>clearInterval(t)},[r]);const A=async()=>{if(!(r!=null&&r.email)){x([]);return}try{const n=(await b()||[]).map(s=>({id:s.id,leaveType:s.type||"Leave",startDate:s.from,endDate:s.to,days:s.duration!=null?Number(s.duration):T(String(s.from).slice(0,10),String(s.to).slice(0,10)),status:String(s.status||"").toLowerCase(),approvedBy:s.approverEmail||"",approvedAt:s.updatedAt||s.createdAt,createdAt:s.createdAt}));x(n)}catch(t){console.warn("Failed to load leave history",t),x([])}},S=async()=>{if(!(r!=null&&r.email))return;const t=new Date().getMonth(),n=new Date().getFullYear();try{const s=await b(),u=a=>{if(a&&a.duration!=null){const o=Number(a.duration);return isNaN(o)?0:Math.max(.5,o)}return T(String(a.from).slice(0,10),String(a.to).slice(0,10))},j=(s||[]).filter(a=>{const o=String(a.status||"").toLowerCase();return o==="approved"||o==="pending"}),H=(s||[]).filter(a=>String(a.status||"").toLowerCase()==="approved"),B=j.filter(a=>{const o=new Date(a.from);return o.getMonth()===t&&o.getFullYear()===n}).reduce((a,o)=>a+u(o),0);N(B);const m=H.filter(a=>new Date(a.from).getFullYear()===n).reduce((a,o)=>a+u(o),0);let i=18,h=Math.max(0,i-m);try{const a=await Y(n);a&&typeof a.annualAllowance<"u"&&(i=Number(a.annualAllowance)),a&&typeof a.remaining<"u"?h=Number(a.remaining):h=Math.max(0,i-m)}catch{h=Math.max(0,i-m)}w(isNaN(i)?18:i),D(isNaN(h)?Math.max(0,(isNaN(i)?18:i)-m):h)}catch(s){console.warn("Failed to compute monthly leaves",s),N(0),w(18),D(18)}},T=(t,n)=>{if(!t||!n)return 0;const s=new Date(t),u=new Date(n);if(t===n)return 1;const j=Math.abs(u-s);return Math.ceil(j/(1e3*60*60*24))+1},R=(g||[]).filter(t=>t.status==="pending"||t.status==="manager_pending"||t.status==="admin_pending");return e.jsxs("div",{className:"dashboard fade-in",children:[e.jsx("h2",{children:"ðŸ–ï¸ Leave History"}),e.jsxs("div",{className:"dashboard-grid",style:{marginBottom:"20px"},children:[e.jsxs("div",{className:"dashboard-card stats-card",style:{background:d>=c?"#f8d7da":"#d4edda"},children:[e.jsx("h3",{style:{color:d>=c?"#721c24":"#155724"},children:"ðŸ“… Monthly Leaves"}),e.jsxs("p",{style:{color:d>=c?"#721c24":"#155724"},children:[d," / ",c]}),d>=c&&e.jsx("small",{style:{color:"#721c24",textAlign:"center",marginTop:10},children:"Limit reached - Team Lead approval required"})]}),e.jsxs("div",{className:"dashboard-card stats-card",style:{background:"#fff3cd"},children:[e.jsx("h3",{style:{color:"#856404"},children:"ðŸ“‹ Yearly Leaves"}),e.jsxs("p",{style:{color:"#856404"},children:[E," / ",k]})]}),e.jsxs("div",{className:"dashboard-card stats-card",style:{background:"#d1ecf1"},children:[e.jsx("h3",{style:{color:"#0c5460"},children:"â³ Pending"}),e.jsx("p",{style:{color:"#0c5460"},children:R.filter(t=>t.status==="pending"||t.status==="manager_pending").length})]})]}),e.jsxs("div",{className:"dashboard-actions",style:{marginBottom:12},children:[e.jsx("button",{className:y==="history"?"btn-primary":"btn-outline",onClick:()=>f("history"),type:"button",children:"Leave History"}),e.jsx("button",{className:y==="holidays"?"btn-primary":"btn-outline",onClick:()=>f("holidays"),type:"button",children:"Holidays"})]}),y==="history"&&e.jsxs("div",{className:"dashboard-card",children:[e.jsx("h3",{children:"ðŸ“š Leave History"}),g.length===0?e.jsx("p",{style:{textAlign:"center",color:"#6c757d"},children:"No leave history found."}):e.jsx("div",{className:"table-container",children:e.jsxs("table",{className:"user-table",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"Type"}),e.jsx("th",{children:"Dates"}),e.jsx("th",{children:"Days"}),e.jsx("th",{children:"Approved By"}),e.jsx("th",{children:"Approved Date"})]})}),e.jsx("tbody",{children:g.sort((t,n)=>new Date(n.approvedAt)-new Date(t.approvedAt)).map(t=>e.jsxs("tr",{children:[e.jsx("td",{children:e.jsx("span",{className:`status-badge ${t.leaveType.toLowerCase().replace(" ","-")}`,children:t.leaveType})}),e.jsxs("td",{children:[p(t.startDate)," - ",p(t.endDate)]}),e.jsx("td",{children:e.jsx("strong",{children:t.days})}),e.jsx("td",{children:t.approvedBy||"-"}),e.jsx("td",{children:p(t.approvedAt)})]},t.id))})]})})]}),y==="holidays"&&e.jsxs("div",{className:"dashboard-card",style:{background:"#eef2ff"},children:[e.jsxs("h3",{style:{color:"#1e3a8a"},children:["ðŸŽ‰ Holidays in ",F]}),M.length>0?e.jsx("div",{style:{marginTop:8,maxHeight:260,overflowY:"auto",paddingRight:6},children:M.map((t,n)=>e.jsxs("div",{style:{padding:"8px 10px",margin:"6px 0",background:"linear-gradient(90deg, rgba(99, 102, 241, 0.14), rgba(239, 246, 255, 0.75))",borderLeft:"5px solid #6366f1",borderRadius:10,fontSize:14,color:"#1e3a8a"},children:[e.jsx("strong",{children:p(t.date)})," â€“ ",t.name]},`${t.date}-${n}`))}):e.jsx("p",{style:{marginTop:8,color:"#1e3a8a"},children:"No holidays this month."})]})]})}export{V as default};

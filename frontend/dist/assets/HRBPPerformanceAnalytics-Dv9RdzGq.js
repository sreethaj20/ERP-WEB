import{M as O,F as a,E as t}from"./vendor-AZjfysqh.js";import{u as U}from"./index-CcBKZM2H.js";import"./router-CieCW4vl.js";function J(){const w=O(),{currentUser:h,users:p,getAttendanceForUser:N}=U(),[c,R]=a.useState(""),[C,k]=a.useState(null),[A,y]=a.useState(!1),[b,x]=a.useState(""),[o,v]=a.useState(null),S=(e="")=>String(e||"").trim().replace(/\s+/g," ").toLowerCase(),T=e=>{const s=S((e==null?void 0:e.designation)||(e==null?void 0:e.position)||""),r=String((e==null?void 0:e.role)||"").toLowerCase();return s==="team lead"||s==="team leader"||s==="tl"||r==="teamlead"},z=e=>{const s=S(e);return s.replace(/\s+/g,"").includes("hrbplead")||s.includes("hrbp")&&s.includes("lead")},E=e=>{const s=S((e==null?void 0:e.designation)||(e==null?void 0:e.position)||"");return!s||z(s)?!1:s.includes("hrbp")||s.includes("hr recruiter")||s.includes("it recruiter")||s.includes("developer")},l=String((h==null?void 0:h.email)||"").toLowerCase(),f=a.useMemo(()=>{const e=Array.isArray(p)?p:[];if(e.length)return e;try{const s=JSON.parse(localStorage.getItem("erpUsers")||"[]");return Array.isArray(s)?s:[]}catch{return[]}},[p]),g=a.useMemo(()=>{const e=(f||[]).filter(r=>T(r)),s=new Set;return e.filter(r=>{const i=String((r==null?void 0:r.email)||"").toLowerCase();return!i||s.has(i)?!1:(s.add(i),!0)})},[f]);a.useMemo(()=>(g||[]).filter(e=>{const s=String((e==null?void 0:e.teamLeadEmail)||"").toLowerCase();return l&&s===l}),[g,l]);const D=a.useMemo(()=>{const e=(f||[]).filter(r=>{const i=String((r==null?void 0:r.teamLeadEmail)||(r==null?void 0:r.reportingTo)||(r==null?void 0:r.reportingToEmail)||(r==null?void 0:r.managerEmail)||"").toLowerCase(),d=l&&i===l,m=!i;return E(r)?d||m:!1}),s=new Set;return e.filter(r=>{const i=String((r==null?void 0:r.email)||"").toLowerCase();return!i||s.has(i)?!1:(s.add(i),!0)})},[f,l]),j=e=>`${String((e==null?void 0:e.firstName)||"").trim()} ${String((e==null?void 0:e.lastName)||"").trim()}`.trim()||String((e==null?void 0:e.email)||""),W=(e=[])=>{const s=Array.isArray(e)?e:[],r=new Date().toISOString().slice(0,7),i=s.filter(n=>String((n==null?void 0:n.date)||"").slice(0,7)===r),d=i.filter(n=>String((n==null?void 0:n.status)||"").toLowerCase()==="present").length,m=i.filter(n=>String((n==null?void 0:n.status)||"").toLowerCase()==="absent").length,H=i.filter(n=>String((n==null?void 0:n.status)||"").toLowerCase()==="leave").length,u=d+m,B=i.reduce((n,L)=>n+(Number(L==null?void 0:L.hours)||0),0),M=Math.max(0,B-d*1),I=d?Number((M/d).toFixed(1)):0;return{monthKey:r,totalRecords:i.length,presentDays:d,absentDays:m,leaveDays:H,workingDays:u,attendanceRate:u?Math.round(d/u*100):0,hours:M,avgHours:I}},P=async e=>{const s=String((e==null?void 0:e.email)||"").toLowerCase();if(s){if(c&&s===c){R(""),k(null),x(""),v(null),y(!1);return}R(s),k(e||null),y(!0),x(""),v(null);try{const r=await N(s);v(W(r||[]))}catch(r){x((r==null?void 0:r.message)||"Failed to load performance")}finally{y(!1)}}};return t.jsxs("div",{className:"dashboard fade-in",style:{padding:20},children:[t.jsxs("div",{className:"dashboard-header",style:{display:"flex",justifyContent:"space-between",alignItems:"center"},children:[t.jsxs("div",{children:[t.jsx("h2",{style:{margin:0},children:"ðŸ“ˆ HRBP Performance Analytics"}),t.jsx("p",{style:{margin:"6px 0 0",color:"#64748b"},children:"Select a Team Lead to view their performance analytics."})]}),t.jsx("button",{className:"btn-outline",onClick:()=>w("/"),children:"â† Back to Home"})]}),t.jsx("div",{className:"dashboard-card",style:{marginTop:12,padding:16},children:t.jsxs("div",{style:{display:"grid",gridTemplateColumns:"repeat(auto-fit, minmax(320px, 1fr))",gap:12},children:[t.jsxs("div",{style:{padding:12,borderRadius:12,border:"1px solid #e5e7eb",background:"#ffffff"},children:[t.jsx("div",{style:{fontWeight:800,marginBottom:10,color:"#0f172a"},children:"All Team Leads"}),g.length?t.jsx("div",{style:{display:"grid",gap:8},children:g.map(e=>{const s=l&&String((e==null?void 0:e.teamLeadEmail)||"").toLowerCase()===l;return t.jsxs("button",{type:"button",className:"btn-outline",style:{textAlign:"left",padding:12,borderRadius:12,background:"#ffffff"},onClick:()=>w(`/teamlead/performance/analytics?leadEmail=${encodeURIComponent(String(e.email||"").toLowerCase())}`),children:[t.jsxs("div",{style:{display:"flex",justifyContent:"space-between",gap:8,alignItems:"baseline"},children:[t.jsx("div",{style:{fontWeight:900,color:"#0f172a"},children:j(e)}),s?t.jsx("div",{style:{fontSize:12,color:"#0f766e",fontWeight:800},children:"My TL"}):null]}),t.jsx("div",{style:{fontSize:12,color:"#64748b"},children:String(e.email||"").toLowerCase()})]},String(e.email||""))})}):t.jsx("div",{style:{color:"#64748b"},children:"No Team Leads found."})]}),t.jsxs("div",{style:{padding:12,borderRadius:12,border:"1px solid #e5e7eb",background:"#ffffff"},children:[t.jsx("div",{style:{fontWeight:800,marginBottom:10,color:"#0f172a"},children:"My Direct Reports"}),D.length?t.jsx("div",{style:{display:"grid",gap:8},children:D.map(e=>{const s=String(e.email||"").toLowerCase(),r=c&&s&&c===s;return t.jsxs("div",{style:{display:"grid",gap:8},children:[t.jsxs("button",{type:"button",className:"btn-outline",style:{textAlign:"left",padding:12,borderRadius:12,background:r?"#f8fafc":"#ffffff"},onClick:()=>P(e),children:[t.jsx("div",{style:{fontWeight:900,color:"#0f172a"},children:j(e)}),t.jsxs("div",{style:{fontSize:12,color:"#64748b"},children:[String(e.designation||e.role||"").trim()||"User"," â€¢ ",s]})]}),r&&(A||b||o)?t.jsxs("div",{style:{padding:12,borderRadius:12,border:"1px solid #e5e7eb",background:"#ffffff"},children:[t.jsx("div",{style:{fontWeight:900,color:"#0f172a",marginBottom:6},children:C?`${j(C)} â€” Performance (${(o==null?void 0:o.monthKey)||new Date().toISOString().slice(0,7)})`:"Performance"}),A?t.jsx("div",{style:{color:"#64748b"},children:"Loading..."}):b?t.jsx("div",{style:{color:"#b91c1c"},children:b}):o?t.jsxs("div",{style:{display:"grid",gridTemplateColumns:"repeat(2, minmax(0, 1fr))",gap:10},children:[t.jsxs("div",{style:{padding:10,borderRadius:10,background:"#f8fafc",border:"1px solid #e5e7eb"},children:[t.jsx("div",{style:{fontSize:12,color:"#64748b"},children:"Attendance Rate"}),t.jsxs("div",{style:{fontWeight:900,fontSize:20,color:"#0f172a"},children:[o.attendanceRate,"%"]})]}),t.jsxs("div",{style:{padding:10,borderRadius:10,background:"#f8fafc",border:"1px solid #e5e7eb"},children:[t.jsx("div",{style:{fontSize:12,color:"#64748b"},children:"Hours Worked"}),t.jsx("div",{style:{fontWeight:900,fontSize:20,color:"#0f172a"},children:o.hours}),t.jsxs("div",{style:{fontSize:12,color:"#64748b"},children:["Avg/day: ",o.avgHours,"h"]})]}),t.jsxs("div",{style:{padding:10,borderRadius:10,background:"#f8fafc",border:"1px solid #e5e7eb"},children:[t.jsx("div",{style:{fontSize:12,color:"#64748b"},children:"Days"}),t.jsxs("div",{style:{fontWeight:900,color:"#0f172a"},children:["Present: ",o.presentDays," â€¢ Absent: ",o.absentDays," â€¢ Leave: ",o.leaveDays]}),t.jsxs("div",{style:{fontSize:12,color:"#64748b"},children:["Records this month: ",o.totalRecords]})]}),t.jsxs("div",{style:{padding:10,borderRadius:10,background:"#f8fafc",border:"1px solid #e5e7eb"},children:[t.jsx("div",{style:{fontSize:12,color:"#64748b"},children:"Working Days"}),t.jsx("div",{style:{fontWeight:900,color:"#0f172a"},children:o.workingDays}),t.jsx("div",{style:{fontSize:12,color:"#64748b"},children:"(Present + Absent)"})]})]}):null]}):null]},String(e.email||""))})}):t.jsx("div",{style:{color:"#64748b"},children:"No direct reports found."})]})]})})]})}export{J as default};

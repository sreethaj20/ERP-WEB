import{F as r,E as e}from"./vendor-AZjfysqh.js";import{u as P,b as B}from"./index-CcBKZM2H.js";import"./router-CieCW4vl.js";function M(){const{users:N,currentUser:a,listTasks:C,createTask:k,updateTask:T,deleteTask:w}=P(),{addNotification:x}=B(),[l,b]=r.useState([]),[u,o]=r.useState(!1),[c,m]=r.useState(null),[h,S]=r.useState("all"),[y,D]=r.useState("all"),[s,p]=r.useState({title:"",description:"",assignedTo:"",priority:"medium",status:"pending",dueDate:"",category:""}),j=N.filter(t=>t.role==="employee");r.useEffect(()=>{f()},[]);const f=async()=>{try{const t=await C();b(t||[])}catch(t){console.warn("Failed to load tasks",t),b([])}},d=t=>{p({...s,[t.target.name]:t.target.value})},$=async t=>{t.preventDefault();const i=j.find(n=>n.email===s.assignedTo);try{if(c){await T(c,{title:s.title,description:s.description,assignedTo:s.assignedTo,priority:s.priority,status:s.status,dueDate:s.dueDate||null,category:s.category,assignedToName:i?`${i.firstName} ${i.lastName}`:"Unassigned",assignedBy:a!=null&&a.firstName||a!=null&&a.lastName?`${a.firstName||""} ${a.lastName||""}`.trim():(a==null?void 0:a.email)||"Admin"}),m(null);try{x({title:"Task Updated",message:`Task updated: ${s.title}`,type:"info",link:"/admin/task-management",audience:`user:${(s.assignedTo||"").toLowerCase()}`})}catch{}}else{const n=await k({title:s.title,description:s.description,assignedTo:s.assignedTo,dueDate:s.dueDate||null});await T(n.id,{priority:s.priority,status:s.status,category:s.category,assignedToName:i?`${i.firstName} ${i.lastName}`:"Unassigned",assignedBy:a!=null&&a.firstName||a!=null&&a.lastName?`${a.firstName||""} ${a.lastName||""}`.trim():(a==null?void 0:a.email)||"Admin"});try{x({title:"Task Created",message:`Task created: ${s.title} â†’ ${s.assignedTo||"Unassigned"}`,type:"success",link:"/admin/task-management",audience:`user:${(s.assignedTo||"").toLowerCase()}`})}catch{}}await f()}catch(n){alert((n==null?void 0:n.message)||"Failed to save task")}p({title:"",description:"",assignedTo:"",priority:"medium",status:"pending",dueDate:"",category:""}),o(!1)},z=t=>{p({title:t.title,description:t.description,assignedTo:t.assignedTo,priority:t.priority,status:t.status,dueDate:t.dueDate,category:t.category}),m(t.id),o(!0)},A=async t=>{if(confirm("Are you sure you want to delete this task?"))try{const i=l.find(n=>n.id===t);await w(t);try{x({title:"Task Deleted",message:`Deleted task #${t}`,type:"warning",link:"/admin/task-management",audience:`user:${(i&&i.assignedTo||"").toLowerCase()}`})}catch{}await f()}catch(i){alert((i==null?void 0:i.message)||"Failed to delete task")}},E=t=>{switch(t){case"completed":return"#28a745";case"in-progress":return"#ffc107";case"pending":return"#6c757d";case"overdue":return"#dc3545";default:return"#6c757d"}},F=t=>{switch(t){case"high":return"#dc3545";case"medium":return"#ffc107";case"low":return"#28a745";default:return"#6c757d"}},v=l.filter(t=>{const i=h==="all"||t.status===h,n=y==="all"||t.assignedTo===y;return i&&n}),g={total:l.length,pending:l.filter(t=>t.status==="pending").length,inProgress:l.filter(t=>t.status==="in-progress").length,completed:l.filter(t=>t.status==="completed").length,overdue:l.filter(t=>t.status==="overdue").length};return e.jsxs("div",{className:"dashboard fade-in",children:[e.jsx("h2",{children:"ðŸ“‹ Task Management"}),e.jsxs("div",{className:"dashboard-grid",style:{marginBottom:"16px",gap:"12px",gridTemplateColumns:"repeat(auto-fit, minmax(180px, 1fr))"},children:[e.jsxs("div",{className:"dashboard-card",style:{background:"#f8f9fa",padding:"14px",borderRadius:"10px"},children:[e.jsx("h3",{style:{color:"#495057",fontSize:"16px",marginBottom:"6px"},children:"ðŸ“Š Total"}),e.jsx("p",{style:{fontSize:"18px",fontWeight:"bold",color:"#495057",margin:0},children:g.total})]}),e.jsxs("div",{className:"dashboard-card",style:{background:"#fff3cd",padding:"14px",borderRadius:"10px"},children:[e.jsx("h3",{style:{color:"#856404",fontSize:"16px",marginBottom:"6px"},children:"â³ Pending"}),e.jsx("p",{style:{fontSize:"18px",fontWeight:"bold",color:"#856404",margin:0},children:g.pending})]}),e.jsxs("div",{className:"dashboard-card",style:{background:"#d1ecf1",padding:"14px",borderRadius:"10px"},children:[e.jsx("h3",{style:{color:"#0c5460",fontSize:"16px",marginBottom:"6px"},children:"ðŸ”„ In Progress"}),e.jsx("p",{style:{fontSize:"18px",fontWeight:"bold",color:"#0c5460",margin:0},children:g.inProgress})]}),e.jsxs("div",{className:"dashboard-card",style:{background:"#d4edda",padding:"14px",borderRadius:"10px"},children:[e.jsx("h3",{style:{color:"#155724",fontSize:"16px",marginBottom:"6px"},children:"âœ… Completed"}),e.jsx("p",{style:{fontSize:"18px",fontWeight:"bold",color:"#155724",margin:0},children:g.completed})]})]}),e.jsxs("div",{style:{display:"flex",gap:"15px",marginBottom:"20px",flexWrap:"wrap",alignItems:"center"},children:[e.jsx("button",{className:"btn-primary",onClick:()=>o(!u),children:u?"Cancel":"+ New Task"}),e.jsxs("select",{value:h,onChange:t=>S(t.target.value),style:{minWidth:"120px"},children:[e.jsx("option",{value:"all",children:"All Status"}),e.jsx("option",{value:"pending",children:"Pending"}),e.jsx("option",{value:"in-progress",children:"In Progress"}),e.jsx("option",{value:"completed",children:"Completed"}),e.jsx("option",{value:"overdue",children:"Overdue"})]}),e.jsxs("select",{value:y,onChange:t=>D(t.target.value),style:{minWidth:"150px"},children:[e.jsx("option",{value:"all",children:"All Employees"}),j.map(t=>e.jsxs("option",{value:t.email,children:[t.firstName," ",t.lastName]},t.email))]})]}),u&&e.jsxs("div",{className:"dashboard-card",style:{marginBottom:"20px"},children:[e.jsx("h3",{children:c?"Edit Task":"Create New Task"}),e.jsxs("form",{onSubmit:$,children:[e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"repeat(auto-fit, minmax(250px, 1fr))",gap:"15px"},children:[e.jsxs("div",{children:[e.jsx("label",{children:"Task Title *"}),e.jsx("input",{type:"text",name:"title",value:s.title,onChange:d,placeholder:"Enter task title",required:!0})]}),e.jsxs("div",{children:[e.jsx("label",{children:"Assign To *"}),e.jsxs("select",{name:"assignedTo",value:s.assignedTo,onChange:d,required:!0,children:[e.jsx("option",{value:"",children:"Select Employee"}),j.map(t=>e.jsxs("option",{value:t.email,children:[t.firstName," ",t.lastName," (",t.email,")"]},t.email))]})]}),e.jsxs("div",{children:[e.jsx("label",{children:"Priority"}),e.jsxs("select",{name:"priority",value:s.priority,onChange:d,children:[e.jsx("option",{value:"low",children:"Low"}),e.jsx("option",{value:"medium",children:"Medium"}),e.jsx("option",{value:"high",children:"High"})]})]}),e.jsxs("div",{children:[e.jsx("label",{children:"Status"}),e.jsxs("select",{name:"status",value:s.status,onChange:d,children:[e.jsx("option",{value:"pending",children:"Pending"}),e.jsx("option",{value:"in-progress",children:"In Progress"}),e.jsx("option",{value:"completed",children:"Completed"}),e.jsx("option",{value:"overdue",children:"Overdue"})]})]}),e.jsxs("div",{children:[e.jsx("label",{children:"Due Date"}),e.jsx("input",{type:"date",name:"dueDate",value:s.dueDate,onChange:d,min:new Date().toISOString().split("T")[0]})]}),e.jsxs("div",{children:[e.jsx("label",{children:"Category"}),e.jsx("input",{type:"text",name:"category",value:s.category,onChange:d,placeholder:"e.g., Development, Marketing"})]})]}),e.jsxs("div",{style:{marginTop:"15px"},children:[e.jsx("label",{children:"Description *"}),e.jsx("textarea",{name:"description",value:s.description,onChange:d,placeholder:"Describe the task in detail...",rows:"3",required:!0})]}),e.jsxs("div",{style:{marginTop:"20px",display:"flex",gap:"10px"},children:[e.jsx("button",{type:"submit",className:"btn-primary",children:c?"Update Task":"Create Task"}),e.jsx("button",{type:"button",className:"btn-outline",onClick:()=>{o(!1),m(null),p({title:"",description:"",assignedTo:"",priority:"medium",status:"pending",dueDate:"",category:""})},children:"Cancel"})]})]})]}),e.jsxs("div",{className:"dashboard-card",children:[e.jsxs("h3",{children:["Tasks (",v.length,")"]}),v.length===0?e.jsxs("div",{style:{textAlign:"center",padding:"40px",color:"#6c757d"},children:[e.jsx("h4",{children:"ðŸ“­ No Tasks Found"}),e.jsx("p",{children:"Create your first task to get started."})]}):e.jsx("div",{style:{display:"grid",gap:"15px"},children:v.map(t=>e.jsxs("div",{className:"dashboard-card",style:{border:"1px solid #dee2e6"},children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"flex-start",marginBottom:"10px"},children:[e.jsxs("div",{style:{flex:1},children:[e.jsx("h4",{style:{margin:"0 0 5px 0",color:"#212529"},children:t.title}),e.jsx("p",{style:{margin:"0 0 10px 0",color:"#6c757d"},children:t.description})]}),e.jsxs("div",{style:{display:"flex",gap:"10px",alignItems:"center"},children:[e.jsxs("span",{className:"status-badge",style:{backgroundColor:F(t.priority),color:"white",textTransform:"capitalize"},children:[t.priority," Priority"]}),e.jsx("span",{className:"status-badge",style:{backgroundColor:E(t.status),color:"white",textTransform:"capitalize"},children:t.status.replace("-"," ")})]})]}),e.jsxs("div",{style:{display:"grid",gridTemplateColumns:"repeat(auto-fit, minmax(150px, 1fr))",gap:"10px",fontSize:"14px",color:"#6c757d"},children:[e.jsxs("div",{children:[e.jsx("strong",{children:"Assigned To:"})," ",t.assignedToName]}),e.jsxs("div",{children:[e.jsx("strong",{children:"Category:"})," ",t.category||"General"]}),e.jsxs("div",{children:[e.jsx("strong",{children:"Due Date:"})," ",t.dueDate?new Date(t.dueDate).toLocaleDateString():"No deadline"]}),e.jsxs("div",{children:[e.jsx("strong",{children:"Created:"})," ",new Date(t.createdAt).toLocaleDateString()]})]}),e.jsxs("div",{style:{marginTop:"15px",display:"flex",gap:"10px",flexWrap:"wrap"},children:[e.jsx("button",{className:"btn-outline",onClick:()=>z(t),style:{fontSize:"12px",padding:"5px 10px"},children:"Edit"}),e.jsx("button",{className:"btn-outline",onClick:()=>A(t.id),style:{fontSize:"12px",padding:"5px 10px",color:"#dc3545",borderColor:"#dc3545"},children:"Delete"})]})]},t.id))})]})]})}export{M as default};

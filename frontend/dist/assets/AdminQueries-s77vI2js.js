import{M as v,F as o,E as s}from"./vendor-AZjfysqh.js";import{u as A,b as N}from"./index-CcBKZM2H.js";import"./router-CieCW4vl.js";function Q(){const{currentUser:C,users:x,listAllAdminQueries:y,respondAdminQuery:c}=A(),j=v(),[u,p]=o.useState([]),[a,g]=o.useState("all"),{addNotification:n}=N(),d=async()=>{try{const e=await y(),t=Array.isArray(e)?e:[];t.sort((r,i)=>new Date(i.updatedAt||i.createdAt||i.date||0)-new Date(r.updatedAt||r.createdAt||r.date||0)),p(t)}catch{p([])}};o.useEffect(()=>{d();const e=setInterval(d,1e4);return()=>clearInterval(e)},[]);const m=async(e,t)=>{try{await c(e,t),await d();const r=(u||[]).find(i=>i.id===e)||{};t.status==="in-progress"&&n({title:"Admin Query Started",message:`#${e} marked In Progress`,type:"info",audience:"role:admin"}),t.status==="closed"&&(n({title:"Admin Query Closed",message:`#${e} has been closed`,type:"success",audience:"role:admin"}),n({title:"Admin Query Closed",message:`Your admin query #${e} has been closed.`,type:"info",link:"/employee/lcrm/admin-query",audience:`user:${(r.employeeEmail||"").toLowerCase()}`}))}catch(r){n({title:"Admin Query",message:(r==null?void 0:r.message)||"Failed to update query",type:"error",ttl:6e3})}},f=e=>{switch(e){case"submitted":return"#ffc107";case"in-progress":return"#007bff";case"resolved":return"#28a745";case"closed":return"#6c757d";default:return"#6c757d"}},h=e=>{const t=(x||[]).find(r=>r.email===e);return t&&(`${t.firstName||""} ${t.lastName||""}`.trim()||t.username)||e},l=u.filter(e=>a==="all"?!0:e.status===a),b=async e=>{const t=prompt(`Respond to #${e.id} - ${e.subject}`);if(t)try{await c(e.id,{response:t,status:"resolved"}),await d(),n({title:"Admin Query Resolved",message:`#${e.id} - ${e.subject} resolved`,type:"success",audience:"role:admin"}),n({title:"Admin Query Resolved",message:`Your admin query #${e.id} has been resolved.`,type:"success",link:"/employee/lcrm/admin-query",audience:`user:${(e.employeeEmail||"").toLowerCase()}`})}catch(r){n({title:"Admin Query",message:(r==null?void 0:r.message)||"Failed to respond",type:"error",ttl:6e3})}};return s.jsxs("div",{className:"dashboard fade-in",children:[s.jsxs("div",{className:"dashboard-header",children:[s.jsx("div",{children:s.jsx("h2",{children:"⚙️ Admin Query Inbox"})}),s.jsxs("div",{style:{display:"flex",gap:8,alignItems:"center"},children:[s.jsx("label",{style:{fontSize:14},children:"Filter:"}),s.jsxs("select",{value:a,onChange:e=>g(e.target.value),children:[s.jsx("option",{value:"all",children:"All"}),s.jsx("option",{value:"submitted",children:"Submitted"}),s.jsx("option",{value:"in-progress",children:"In Progress"}),s.jsx("option",{value:"resolved",children:"Resolved"}),s.jsx("option",{value:"closed",children:"Closed"})]}),s.jsx("button",{className:"btn-outline",onClick:()=>j("/admin/dashboard"),children:"← Back"})]})]}),s.jsx("div",{className:"table-wrapper",children:s.jsxs("table",{className:"one-on-one-table",style:{width:"100%"},children:[s.jsx("thead",{children:s.jsxs("tr",{children:[s.jsx("th",{children:"ID"}),s.jsx("th",{children:"Employee"}),s.jsx("th",{children:"Category"}),s.jsx("th",{children:"Subject"}),s.jsx("th",{children:"Status"}),s.jsx("th",{children:"Date"}),s.jsx("th",{style:{width:220},children:"Actions"})]})}),s.jsx("tbody",{children:l.length===0?s.jsx("tr",{children:s.jsx("td",{colSpan:7,style:{textAlign:"center"},children:"No admin queries found."})}):l.map(e=>{var t;return s.jsxs("tr",{children:[s.jsxs("td",{children:["#",e.id]}),s.jsxs("td",{children:[h(e.employeeEmail)," (",e.employeeEmail,")"]}),s.jsx("td",{children:s.jsx("span",{className:"role-badge",children:e.category})}),s.jsx("td",{children:e.subject}),s.jsx("td",{children:s.jsx("span",{style:{padding:"4px 8px",borderRadius:4,fontSize:12,fontWeight:"bold",backgroundColor:f(e.status),color:"#fff"},children:(t=e.status)==null?void 0:t.toUpperCase()})}),s.jsx("td",{children:e.date}),s.jsxs("td",{style:{display:"flex",gap:6,justifyContent:"center"},children:[e.status==="submitted"&&s.jsx("button",{className:"btn-primary",style:{padding:"4px 8px",fontSize:12},onClick:()=>m(e.id,{status:"in-progress"}),children:"Start"}),e.status==="in-progress"&&s.jsx("button",{className:"btn-primary",style:{padding:"4px 8px",fontSize:12},onClick:()=>b(e),children:"Resolve"}),e.status==="resolved"&&s.jsx("button",{className:"btn-outline",style:{padding:"4px 8px",fontSize:12},onClick:()=>m(e.id,{status:"closed"}),children:"Close"})]})]},e.id)})})]})}),l.map(e=>s.jsxs("div",{className:"dashboard-card",style:{marginTop:12,textAlign:"left"},children:[s.jsxs("h4",{children:["#",e.id," - ",e.subject]}),s.jsxs("p",{children:[s.jsx("strong",{children:"Employee:"})," ",h(e.employeeEmail)," (",e.employeeEmail,")"]}),e.description&&s.jsxs("p",{children:[s.jsx("strong",{children:"Description:"})," ",e.description]}),e.response&&s.jsxs("div",{style:{marginTop:10,padding:10,background:"#e3f2fd",borderLeft:"4px solid #2196f3",borderRadius:4},children:[s.jsx("strong",{children:"Admin Response:"}),s.jsx("p",{style:{margin:"6px 0 0 0"},children:e.response})]})]},`detail-${e.id}`))]})}export{Q as default};

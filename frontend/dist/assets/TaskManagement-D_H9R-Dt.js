import{M as ne,F as c,E as e}from"./vendor-AZjfysqh.js";import{u as de,b as oe}from"./index-CcBKZM2H.js";import"./router-CieCW4vl.js";function pe(){const{users:b,currentUser:s,listTasks:R,createTask:M,updateTask:T,deleteTask:H}=de(),{addNotification:j}=oe(),D=ne(),[l,A]=c.useState([]),[W,v]=c.useState(!1),[y,k]=c.useState(null),[N,I]=c.useState("all"),[w,O]=c.useState("all"),[d,C]=c.useState({title:"",description:"",assignedTo:"",priority:"medium",status:"pending",dueDate:"",category:""}),x=c.useMemo(()=>{const t=Array.isArray(b)?b:[];if(t.length>0)return t;try{const i=localStorage.getItem("erpUsers"),a=i?JSON.parse(i):[];return Array.isArray(a)?a:[]}catch{return[]}},[b]),u=(t="")=>String(t||"").trim().replace(/\s+/g," ").toLowerCase(),S=t=>{const i=u(t);return i.replace(/\s+/g,"").includes("hrbplead")||i.includes("hrbp")&&i.includes("lead")},L=(()=>{const t=u((s==null?void 0:s.designation)||(s==null?void 0:s.position)||"");return t.replace(/\s+/g,"")==="hrbp"||t.includes("hrbp")&&!S(t)})(),F=(t="")=>String(t||"").trim().toLowerCase(),_=(t={})=>`${String((t==null?void 0:t.firstName)||"").trim()} ${String((t==null?void 0:t.lastName)||"").trim()}`.trim().toLowerCase(),q=(t=[])=>{const i=F(s==null?void 0:s.email),a=_(s);if(!i&&!a)return[];const o=n=>{const r=String(n??"").trim();if(!r)return!1;const h=r.toLowerCase().replace(/\s+/g," ").trim(),ie=i&&(h===i||h.includes(i)),ae=a&&(h===a||h.includes(a)||a.includes(h));return ie||ae};return(t||[]).filter(n=>{const r=String((n==null?void 0:n.role)||"").toLowerCase();return r!=="admin"&&r!=="teamlead"}).filter(n=>{const r=F(n==null?void 0:n.teamLeadEmail);return i&&r&&r===i?!0:[n==null?void 0:n.reportingTo,n==null?void 0:n.reporting_to,n==null?void 0:n.reportingToEmail,n==null?void 0:n.reporting_to_email,n==null?void 0:n.managerEmail,n==null?void 0:n.manager,n==null?void 0:n["Reporting To"],n==null?void 0:n.ReportingTo,n==null?void 0:n.ReportingToEmail].some(o)})},V=(t=[])=>(t||[]).filter(i=>{const a=u((i==null?void 0:i.designation)||(i==null?void 0:i.position)||"");return!a||S(a)?!1:a.includes("hrbp")||a.includes("hr recruiter")||a.includes("it recruiter")||a.includes("developer")}),Y=u((s==null?void 0:s.designation)||"")==="team lead",E=S((s==null?void 0:s.designation)||(s==null?void 0:s.position)||""),J=x.some(t=>(t.teamLeadEmail||"").toLowerCase()===((s==null?void 0:s.email)||"").toLowerCase()),G=E||L||Y||J,g=(()=>{const t=((s==null?void 0:s.email)||"").toLowerCase();if(!t)return[];if(E||L){const i=q(x);return i.length?i:V(x)}return x.filter(i=>i.role==="employee"&&(i.teamLeadEmail||"").toLowerCase()===t)})();c.useEffect(()=>{f()},[x,s]);const f=async()=>{try{const t=await R(),i=new Set((g||[]).map(o=>String(o.email||"").toLowerCase()).filter(Boolean)),a=(t||[]).filter(o=>!o.assignedTo||i.has(String(o.assignedTo).toLowerCase()));A(a)}catch(t){console.warn("Failed to load tasks",t),A([])}},p=t=>{C({...d,[t.target.name]:t.target.value})},K=async t=>{if(t.preventDefault(),d.assignedTo&&!g.some(a=>a.email===d.assignedTo)){alert("You can only assign tasks to your own team members.");return}const i=g.find(a=>a.email===d.assignedTo);try{if(y){await T(y,{title:d.title,description:d.description,assignedTo:d.assignedTo,priority:d.priority,status:d.status,dueDate:d.dueDate||null,category:d.category,assignedToName:i?`${i.firstName} ${i.lastName}`:"Unassigned",assignedBy:s!=null&&s.firstName||s!=null&&s.lastName?`${s.firstName||""} ${s.lastName||""}`.trim():(s==null?void 0:s.email)||"Team Lead"}),k(null);try{j({title:"Team Task Updated",message:`Updated: ${d.title}`,type:"info",link:"/teamlead/task-management",audience:`user:${(d.assignedTo||"").toLowerCase()}`})}catch{}}else{const a=await M({title:d.title,description:d.description,assignedTo:d.assignedTo,dueDate:d.dueDate||null});await T(a.id,{priority:d.priority,status:d.status,category:d.category,assignedToName:i?`${i.firstName} ${i.lastName}`:"Unassigned",assignedBy:s!=null&&s.firstName||s!=null&&s.lastName?`${s.firstName||""} ${s.lastName||""}`.trim():(s==null?void 0:s.email)||"Team Lead"});try{j({title:"Team Task Created",message:`Created: ${d.title} ‚Üí ${d.assignedTo||"Unassigned"}`,type:"success",link:"/teamlead/task-management",audience:`user:${(d.assignedTo||"").toLowerCase()}`})}catch{}}await f()}catch(a){alert((a==null?void 0:a.message)||"Failed to save task")}$()},$=()=>{C({title:"",description:"",assignedTo:"",priority:"medium",status:"pending",dueDate:"",category:""}),v(!1)},Q=t=>{C({title:t.title,description:t.description,assignedTo:t.assignedTo,priority:t.priority,status:t.status,dueDate:t.dueDate,category:t.category}),k(t.id),v(!0)},X=async t=>{if(window.confirm("Are you sure you want to delete this task?"))try{const i=l.find(a=>a.id===t);await H(t);try{j({title:"Team Task Deleted",message:`Deleted task #${t}`,type:"warning",link:"/teamlead/task-management",audience:`user:${(i&&i.assignedTo||"").toLowerCase()}`})}catch{}await f()}catch(i){alert((i==null?void 0:i.message)||"Failed to delete task")}},Z=async(t,i)=>{try{const a=l.find(o=>o.id===t);await T(t,{status:i,updatedAt:new Date().toISOString()});try{j({title:"Team Task Status",message:`Task #${t} ‚Üí ${i}`,type:"info",link:"/teamlead/task-management",audience:`user:${(a&&a.assignedTo||"").toLowerCase()}`})}catch{}await f()}catch(a){alert((a==null?void 0:a.message)||"Failed to update status")}},P=l.filter(t=>{const i=N==="all"||t.status===N,a=!t.assignedTo||g.some(B=>B.email===t.assignedTo),o=w==="all"||t.assignedTo===w;return i&&o&&a}),U=()=>({total:l.length,pending:l.filter(t=>t.status==="pending").length,inProgress:l.filter(t=>t.status==="in-progress").length,completed:l.filter(t=>t.status==="completed").length,overdue:l.filter(t=>new Date(t.dueDate)<new Date&&t.status!=="completed").length}),ee=t=>{switch(t){case"high":return"#F44336";case"medium":return"#FF9800";case"low":return"#4CAF50";default:return"#757575"}},te=t=>{switch(t){case"completed":return"#4CAF50";case"in-progress":return"#2196F3";case"pending":return"#FF9800";default:return"#757575"}},m=U(),z=()=>{(s==null?void 0:s.role)==="admin"?D("/admin/dashboard"):D("/")};return G?e.jsxs("div",{className:"dashboard fade-in",children:[e.jsxs("div",{className:"dashboard-header",children:[e.jsxs("div",{children:[e.jsx("h2",{children:"üìã Task Management"}),e.jsx("p",{children:"Assign and track tasks for your team members."})]}),e.jsx("button",{className:"btn-outline back-to-dashboard",onClick:z,children:"‚Üê Back to Home"})]}),e.jsxs("div",{className:"task-controls",children:[e.jsx("button",{className:"btn-primary",onClick:()=>v(!0),children:"Create New Task"}),e.jsxs("div",{className:"task-filters",children:[e.jsxs("select",{value:N,onChange:t=>I(t.target.value),children:[e.jsx("option",{value:"all",children:"All Status"}),e.jsx("option",{value:"pending",children:"Pending"}),e.jsx("option",{value:"in-progress",children:"In Progress"}),e.jsx("option",{value:"completed",children:"Completed"})]}),e.jsxs("select",{value:w,onChange:t=>O(t.target.value),children:[e.jsx("option",{value:"all",children:"All Assignees"}),g.map(t=>e.jsxs("option",{value:t.email,children:[t.firstName," ",t.lastName]},t.email))]})]})]}),e.jsxs("div",{className:"task-stats",children:[e.jsx("h3",{children:"üìä Task Overview"}),e.jsxs("table",{style:{width:"100%",borderCollapse:"collapse",marginTop:"20px",marginBottom:"30px"},children:[e.jsx("thead",{children:e.jsxs("tr",{style:{backgroundColor:"#f5f5f5",borderBottom:"2px solid #ddd"},children:[e.jsx("th",{style:{padding:"12px",textAlign:"center",border:"1px solid #ddd"},children:"Total Tasks"}),e.jsx("th",{style:{padding:"12px",textAlign:"center",border:"1px solid #ddd"},children:"Pending"}),e.jsx("th",{style:{padding:"12px",textAlign:"center",border:"1px solid #ddd"},children:"In Progress"}),e.jsx("th",{style:{padding:"12px",textAlign:"center",border:"1px solid #ddd"},children:"Completed"}),e.jsx("th",{style:{padding:"12px",textAlign:"center",border:"1px solid #ddd"},children:"Overdue"})]})}),e.jsx("tbody",{children:e.jsxs("tr",{children:[e.jsx("td",{style:{padding:"20px",textAlign:"center",border:"1px solid #ddd",fontSize:"24px",fontWeight:"bold"},children:m.total}),e.jsx("td",{style:{padding:"20px",textAlign:"center",border:"1px solid #ddd",fontSize:"24px",fontWeight:"bold",color:"#FF9800"},children:m.pending}),e.jsx("td",{style:{padding:"20px",textAlign:"center",border:"1px solid #ddd",fontSize:"24px",fontWeight:"bold",color:"#2196F3"},children:m.inProgress}),e.jsx("td",{style:{padding:"20px",textAlign:"center",border:"1px solid #ddd",fontSize:"24px",fontWeight:"bold",color:"#4CAF50"},children:m.completed}),e.jsx("td",{style:{padding:"20px",textAlign:"center",border:"1px solid #ddd",fontSize:"24px",fontWeight:"bold",color:"#F44336"},children:m.overdue})]})})]})]}),W&&e.jsx("div",{className:"form-overlay",children:e.jsxs("div",{className:"form-container",children:[e.jsx("h3",{children:y?"Edit Task":"Create New Task"}),e.jsxs("form",{onSubmit:K,children:[e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Task Title"}),e.jsx("input",{type:"text",name:"title",value:d.title,onChange:p,required:!0})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Description"}),e.jsx("textarea",{name:"description",value:d.description,onChange:p,rows:"3"})]}),e.jsxs("div",{className:"form-row",children:[e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Assign To"}),e.jsxs("select",{name:"assignedTo",value:d.assignedTo,onChange:p,required:!0,children:[e.jsx("option",{value:"",children:"Select Employee"}),g.map(t=>e.jsxs("option",{value:t.email,children:[t.firstName," ",t.lastName]},t.email))]})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Category"}),e.jsx("input",{type:"text",name:"category",value:d.category,onChange:p,placeholder:"e.g., Development, Design, Testing"})]})]}),e.jsxs("div",{className:"form-row",children:[e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Priority"}),e.jsxs("select",{name:"priority",value:d.priority,onChange:p,children:[e.jsx("option",{value:"low",children:"Low"}),e.jsx("option",{value:"medium",children:"Medium"}),e.jsx("option",{value:"high",children:"High"})]})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Status"}),e.jsxs("select",{name:"status",value:d.status,onChange:p,children:[e.jsx("option",{value:"pending",children:"Pending"}),e.jsx("option",{value:"in-progress",children:"In Progress"}),e.jsx("option",{value:"completed",children:"Completed"})]})]})]}),e.jsxs("div",{className:"form-group",children:[e.jsx("label",{children:"Due Date"}),e.jsx("input",{type:"date",name:"dueDate",value:d.dueDate,onChange:p})]}),e.jsxs("div",{className:"form-actions",children:[e.jsx("button",{type:"submit",className:"btn-primary",children:y?"Update Task":"Create Task"}),e.jsx("button",{type:"button",className:"btn-outline",onClick:$,children:"Cancel"})]})]})]})}),e.jsxs("div",{className:"tasks-table",children:[e.jsx("h3",{children:"üìã Task Details"}),P.length>0?e.jsxs("table",{style:{width:"100%",borderCollapse:"collapse",marginTop:"20px"},children:[e.jsx("thead",{children:e.jsxs("tr",{style:{backgroundColor:"#f5f5f5",borderBottom:"2px solid #ddd"},children:[e.jsx("th",{style:{padding:"12px",textAlign:"left",border:"1px solid #ddd"},children:"Task Title"}),e.jsx("th",{style:{padding:"12px",textAlign:"left",border:"1px solid #ddd"},children:"Assigned To"}),e.jsx("th",{style:{padding:"12px",textAlign:"left",border:"1px solid #ddd"},children:"Category"}),e.jsx("th",{style:{padding:"12px",textAlign:"center",border:"1px solid #ddd"},children:"Priority"}),e.jsx("th",{style:{padding:"12px",textAlign:"center",border:"1px solid #ddd"},children:"Status"}),e.jsx("th",{style:{padding:"12px",textAlign:"center",border:"1px solid #ddd"},children:"Due Date"}),e.jsx("th",{style:{padding:"12px",textAlign:"center",border:"1px solid #ddd"},children:"Created"}),e.jsx("th",{style:{padding:"12px",textAlign:"center",border:"1px solid #ddd"},children:"Actions"})]})}),e.jsx("tbody",{children:P.map(t=>e.jsxs("tr",{style:{borderBottom:"1px solid #ddd"},children:[e.jsx("td",{style:{padding:"12px",border:"1px solid #ddd"},children:e.jsxs("div",{children:[e.jsx("strong",{children:t.title}),t.description&&e.jsx("div",{style:{fontSize:"12px",color:"#666",marginTop:"4px"},children:t.description.length>50?`${t.description.substring(0,50)}...`:t.description})]})}),e.jsx("td",{style:{padding:"12px",border:"1px solid #ddd"},children:t.assignedToName}),e.jsx("td",{style:{padding:"12px",border:"1px solid #ddd"},children:t.category||"Not specified"}),e.jsx("td",{style:{padding:"12px",textAlign:"center",border:"1px solid #ddd"},children:e.jsx("span",{style:{backgroundColor:ee(t.priority),color:"white",padding:"4px 8px",borderRadius:"12px",fontSize:"12px",textTransform:"capitalize"},children:t.priority})}),e.jsx("td",{style:{padding:"12px",textAlign:"center",border:"1px solid #ddd"},children:e.jsxs("select",{value:t.status,onChange:i=>Z(t.id,i.target.value),style:{backgroundColor:te(t.status),color:"white",border:"none",padding:"4px 8px",borderRadius:"4px",fontSize:"12px"},children:[e.jsx("option",{value:"pending",children:"Pending"}),e.jsx("option",{value:"in-progress",children:"In Progress"}),e.jsx("option",{value:"completed",children:"Completed"})]})}),e.jsx("td",{style:{padding:"12px",textAlign:"center",border:"1px solid #ddd"},children:e.jsxs("div",{style:{fontSize:"12px"},children:[t.dueDate?new Date(t.dueDate).toLocaleDateString():"Not set",t.dueDate&&new Date(t.dueDate)<new Date&&t.status!=="completed"&&e.jsx("div",{style:{color:"#F44336",fontWeight:"bold",marginTop:"2px"},children:"OVERDUE"})]})}),e.jsx("td",{style:{padding:"12px",textAlign:"center",border:"1px solid #ddd",fontSize:"12px"},children:new Date(t.createdAt).toLocaleDateString()}),e.jsx("td",{style:{padding:"12px",textAlign:"center",border:"1px solid #ddd"},children:e.jsxs("div",{style:{display:"flex",gap:"4px",justifyContent:"center"},children:[e.jsx("button",{className:"btn-outline",onClick:()=>Q(t),style:{padding:"4px 8px",fontSize:"12px"},children:"Edit"}),e.jsx("button",{className:"btn-danger",onClick:()=>X(t.id),style:{padding:"4px 8px",fontSize:"12px"},children:"Delete"})]})})]},t.id))})]}):e.jsx("div",{className:"empty-state",children:e.jsx("p",{children:"No tasks found. Create some tasks to get started."})})]})]}):e.jsxs("div",{className:"dashboard fade-in",style:{padding:20},children:[e.jsxs("div",{className:"dashboard-header",children:[e.jsx("div",{children:e.jsx("h2",{children:"üìã Task Management"})}),e.jsx("button",{className:"btn-outline back-to-dashboard",onClick:z,children:"‚Üê Back to Home"})]}),e.jsx("div",{className:"card",style:{padding:16,marginTop:12},children:e.jsx("p",{style:{margin:0},children:"You are not assigned as a Team Lead or do not have any direct reports yet."})})]})}export{pe as default};

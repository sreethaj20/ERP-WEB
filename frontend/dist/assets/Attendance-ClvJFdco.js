import{E as e,M as Q,F as p}from"./vendor-AZjfysqh.js";import{u as Z}from"./index-CcBKZM2H.js";import{g as J}from"./holidays-BHBlvUOY.js";import"./router-CieCW4vl.js";const _=({presentDays:a,totalDays:E=22,size:g=120,strokeWidth:y=12})=>{const v=Math.min(100,Math.max(0,a/E*100)),w=(g-y)/2,S=w*2*Math.PI,W=S-v/100*S,$=()=>v>=90?"#10B981":v>=75?"#F59E0B":"#EF4444";return e.jsxs("div",{className:"attendance-circle-container",children:[e.jsxs("svg",{width:g,height:g,className:"attendance-svg",children:[e.jsx("circle",{className:"attendance-circle-bg",stroke:"#E5E7EB",fill:"transparent",strokeWidth:y,r:w,cx:g/2,cy:g/2}),e.jsx("circle",{className:"attendance-circle-progress",stroke:$(),fill:"transparent",strokeWidth:y,strokeLinecap:"round",r:w,cx:g/2,cy:g/2,style:{strokeDasharray:S,strokeDashoffset:W,transform:"rotate(-90deg)",transformOrigin:"50% 50%",transition:"stroke-dashoffset 0.6s ease-out, stroke 0.6s ease-out"}})]}),e.jsxs("div",{className:"attendance-text",children:[e.jsxs("span",{className:"attendance-percentage",children:[Math.round(v),"%"]}),e.jsxs("span",{className:"attendance-days",children:[a,"/",E," days"]})]})]})};function ne(){const{currentUser:a,logAttendance:E,getUserMetrics:g,getAttendanceForUser:y}=Z(),v=Q(),[w,S]=p.useState("Present"),[W,$]=p.useState("8"),[j,N]=p.useState([]),[z,A]=p.useState(null),[u,P]=p.useState(new Date().toISOString().slice(0,7)),k=()=>{var r;const t=(a==null?void 0:a.dateOfJoining)||((r=JSON.parse(localStorage.getItem("erpUsers")||"[]").find(n=>(n.email||"").toLowerCase()===((a==null?void 0:a.email)||"").toLowerCase()))==null?void 0:r.dateOfJoining)||"";if(!t)return null;const s=new Date(t);return isNaN(s.getTime())?null:s},F=t=>t instanceof Date?t.toISOString().slice(0,10):String(t).slice(0,10),Y=()=>String((a==null?void 0:a.designation)||"").toLowerCase().includes("developer"),M=t=>{const s=t.getDay();return Y()?s===0||s===6:s===3},R=(t,s)=>{const r=new Date(t,s+1,0).getDate(),n=J(t,s).map(i=>i.date);let o=0;for(let i=1;i<=r;i++){const c=new Date(t,s,i),h=`${t}-${String(s+1).padStart(2,"0")}-${String(i).padStart(2,"0")}`,l=M(c),m=n.includes(h);!l&&!m&&o++}return o},L=(t,s)=>{const r=k(),n=R(t,s);if(!r)return n;const o=r.getFullYear(),i=r.getMonth();if(o>t||o===t&&i>s)return 0;if(o===t&&i===s){const c=new Date(t,s+1,0).getDate(),h=J(t,s).map(m=>m.date);let l=0;for(let m=r.getDate();m<=c;m++){const H=new Date(t,s,m),B=`${t}-${String(s+1).padStart(2,"0")}-${String(m).padStart(2,"0")}`,d=M(H),f=h.includes(B);!d&&!f&&l++}return l}return n},I=t=>{const s=j.find(h=>{var l;return((l=h.date)==null?void 0:l.slice(0,10))===t});if(s!=null&&s.status)return s.status;const r=k();if(r&&t<F(r))return"Not Marked";const[n,o,i]=t.split("-").map(Number),c=new Date(n,(o||1)-1,i||1);return M(c)?"Week Off":"Not Marked"},K=()=>{const t=new Date,s=t.getDay(),r=(s===0?-6:1)-s,n=new Date(t);n.setDate(t.getDate()+r);const o=new Date(n);o.setDate(n.getDate()+6);const i=c=>c.toISOString().slice(0,10);return{start:i(n),end:i(o),monday:n,sunday:o}};p.useEffect(()=>{(async()=>{try{if(!(a!=null&&a.email)){N([]),A(null);return}const s=await y(a.email);N(Array.isArray(s)?s:[]),A(g(a.email))}catch{N([]),A(null)}})()},[a,g,y]),p.useEffect(()=>{const t=async()=>{try{if(!(a!=null&&a.email))return;const s=await y(a.email);N(Array.isArray(s)?s:[])}catch{}};return window.addEventListener("erp-attendance-updated",t),()=>window.removeEventListener("erp-attendance-updated",t)},[a,y]);const D=p.useMemo(()=>j.length?j.reduce((t,s)=>{const r=new Date(s.date),n=`${r.getFullYear()}-${String(r.getMonth()+1).padStart(2,"0")}`;return t[n]||(t[n]={total:0,present:0,absent:0,leave:0,hours:0}),t[n].total++,t[n].hours+=Number(s.hours)||0,s.status==="Present"&&t[n].present++,s.status==="Absent"&&t[n].absent++,s.status==="Leave"&&t[n].leave++,t},{}):{},[j]),b=p.useMemo(()=>{const t=new Date,s=t.toISOString().slice(0,7),r=L(t.getFullYear(),t.getMonth());return{...D[s]||{present:0,absent:0,leave:0,hours:0},total:r}},[D]),O=p.useMemo(()=>{if(!j.length)return{totalHours:0,start:"",end:""};const{start:t,end:s}=K(),r=j.filter(c=>{var l;const h=(l=c.date)==null?void 0:l.slice(0,10);return h>=t&&h<=s}),n=r.reduce((c,h)=>c+(Number(h.hours)||0),0),o=r.filter(c=>c.status==="Present").length;return{totalHours:Math.max(0,n-o*1),start:t,end:s}},[j]),V=()=>{v("/")};return e.jsxs("div",{className:"dashboard fade-in",children:[e.jsxs("div",{className:"dashboard-header",children:[e.jsx("div",{children:e.jsx("h2",{children:"ğŸ“… My Attendance"})}),e.jsx("button",{className:"btn-outline back-to-dashboard",onClick:V,children:"â† Back to Home"})]}),e.jsxs("div",{className:"dashboard-card",style:{marginBottom:20,textAlign:"center"},children:[e.jsx("h3",{children:"ğŸ“Š This Month's Attendance"}),e.jsx("div",{style:{display:"flex",justifyContent:"center",margin:"20px 0"},children:e.jsx(_,{presentDays:b.present,totalDays:b.total||22,size:180,strokeWidth:16})}),e.jsxs("div",{style:{display:"flex",justifyContent:"space-around",marginTop:"20px",flexWrap:"wrap",gap:"15px"},children:[e.jsxs("div",{className:"attendance-metric",children:[e.jsx("div",{className:"metric-value",style:{color:"#10B981"},children:b.present||0}),e.jsx("div",{className:"metric-label",children:"Present Days"})]}),e.jsxs("div",{className:"attendance-metric",children:[e.jsx("div",{className:"metric-value",style:{color:"#EF4444"},children:b.absent||0}),e.jsx("div",{className:"metric-label",children:"Absent Days"})]}),e.jsxs("div",{className:"attendance-metric",children:[e.jsx("div",{className:"metric-value",style:{color:"#F59E0B"},children:b.leave||0}),e.jsx("div",{className:"metric-label",children:"Leave Days"})]}),e.jsxs("div",{className:"attendance-metric",children:[e.jsx("div",{className:"metric-value",children:b.hours||0}),e.jsx("div",{className:"metric-label",children:"Total Hours (Month)"})]})]})]}),e.jsxs("div",{className:"dashboard-card",style:{marginBottom:20},children:[e.jsx("h3",{children:"ğŸ•’ This Week's Hours"}),e.jsxs("p",{children:["Week: ",O.start," to ",O.end]}),e.jsxs("div",{style:{fontSize:"1.6rem",fontWeight:"bold"},children:[O.totalHours," hours"]})]}),e.jsxs("div",{className:"dashboard-card",style:{marginBottom:20},children:[e.jsx("h3",{children:"ğŸ“† View Attendance by Month"}),e.jsx("div",{style:{margin:"15px 0"},children:e.jsx("input",{type:"month",value:u,onChange:t=>P(t.target.value),style:{padding:"8px",borderRadius:"4px",border:"1px solid #ddd"}})}),(()=>{const t=k(),s=t?F(t).slice(0,7):null;return(s?u<s:!1)?e.jsx("div",{className:"dashboard-card",style:{padding:16,background:"#f8fafc",borderRadius:8},children:e.jsxs("p",{style:{margin:0,color:"#334155"},children:["Attendance not available before your Date of Joining (",s,")."]})}):D[u]?e.jsxs("div",{className:"monthly-summary",children:[e.jsx("h4",{children:new Date(u+"-01").toLocaleDateString("en-US",{month:"long",year:"numeric"})}),e.jsx("div",{style:{overflowX:"auto",marginBottom:16},children:(()=>{const n=Number(u.split("-")[0]),o=Number(u.split("-")[1])-1,i=new Date(n,o,1),c=new Date(n,o+1,0).getDate(),h=i.getDay(),l=[];let m=1;for(;m<=c;){const d=[];for(let f=0;f<7;f++)l.length===0&&f<h?d.push(null):m<=c?d.push(m++):d.push(null);l.push(d)}const H={width:36,height:36,borderRadius:6,display:"flex",alignItems:"center",justifyContent:"center",border:"1px solid #eee",fontSize:12},B=d=>{if(!d)return"transparent";const f=`${u}-${String(d).padStart(2,"0")}`,x=I(f),[C,X,q]=f.split("-").map(Number),G=new Date(C,(X||1)-1,q||1),T=k();return T&&f<F(T)?"transparent":M(G)?"#FEE2E2":x==="Present"?"#D1FAE5":x==="Leave"?"#FEF3C7":x==="Absent"||x==="Week Off"?"#FEE2E2":"transparent"};return e.jsxs("table",{className:"user-table attendance-calendar",style:{minWidth:320},children:[e.jsx("thead",{children:e.jsx("tr",{children:["Sun","Mon","Tue","Wed","Thu","Fri","Sat"].map(d=>e.jsx("th",{style:{textAlign:"center"},children:d},d))})}),e.jsx("tbody",{children:l.map((d,f)=>e.jsx("tr",{children:d.map((x,C)=>e.jsx("td",{style:{textAlign:"center"},children:e.jsx("div",{style:{...H,background:B(x)},title:x?`${x} ${new Date(n,o,x).toLocaleDateString("en-US",{month:"short"})} ${n}`:"",children:x||""})},C))},f))})]})})()}),e.jsxs("table",{className:"user-table",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"Present"}),e.jsx("th",{children:"Absent"}),e.jsx("th",{children:"Leave"}),e.jsx("th",{children:"Working Days"}),e.jsx("th",{children:"Total Hours"}),e.jsx("th",{children:"Avg Hours/Day"})]})}),e.jsx("tbody",{children:e.jsxs("tr",{children:[e.jsx("td",{children:D[u].present}),e.jsx("td",{children:D[u].absent}),e.jsx("td",{children:D[u].leave}),e.jsx("td",{children:(()=>{const[n,o]=u.split("-").map(Number);return L(n,o-1)})()}),e.jsx("td",{children:D[u].hours})]})})]})]}):e.jsx("p",{children:"No attendance data available for the selected month."})})()]})]})}export{ne as default};

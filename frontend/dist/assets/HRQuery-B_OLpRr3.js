import{M as Q,F as n,E as e,U as L}from"./vendor-AZjfysqh.js";import{u as M,b as I,g as H}from"./index-CcBKZM2H.js";import"./router-CieCW4vl.js";function W(){var w;const{currentUser:a,users:m,listMyHrQueries:N,createHrQuery:A,listHRUsers:h}=M(),g=Q(),[r,o]=n.useState({category:"leave",subject:"",description:"",urgency:"normal",hrEmail:""}),[j,b]=n.useState([]),[x,f]=n.useState(!1),{addNotification:y}=I();if((H(a)||"").toLowerCase()==="hr")return e.jsx(L,{to:"/hr/lcrm",replace:!0});const[d,v]=n.useState([]),[E,c]=n.useState(!1),[R,p]=n.useState("");n.useEffect(()=>{let t=!1;return(async()=>{try{c(!0),p("");const s=await h();!t&&Array.isArray(s)&&v(s)}catch(s){t||p((s==null?void 0:s.message)||"Failed to load HR list")}finally{t||c(!1)}})(),()=>{t=!0}},[h]);const C=n.useMemo(()=>{let t=Array.isArray(m)?m.slice():[];if(Array.isArray(d)&&d.length){const s=new Map(t.map(i=>[String(i.email||"").toLowerCase(),i]));d.forEach(i=>s.set(String(i.email||"").toLowerCase(),i)),t=Array.from(s.values())}if(!t.length)try{const s=localStorage.getItem("erpUsers"),i=s?JSON.parse(s):[];Array.isArray(i)&&(t=i)}catch{}const l=(t||[]).filter(s=>(H(s)||"").toLowerCase()==="hr");return l.sort((s,i)=>`${s.firstName||""} ${s.lastName||""}`.trim().localeCompare(`${i.firstName||""} ${i.lastName||""}`.trim())),l},[d,m]),S=((w=a==null?void 0:a.name)==null?void 0:w.trim())||(a!=null&&a.email?a.email.split("@")[0]:"Employee"),u=async()=>{try{const t=await N(),l=Array.isArray(t)?t:[];l.sort((s,i)=>new Date(i.updatedAt||i.createdAt||i.date||0)-new Date(s.updatedAt||s.createdAt||s.date||0)),b(l)}catch{b([])}};n.useEffect(()=>{u();const t=setInterval(u,1e4);return()=>clearInterval(t)},[a==null?void 0:a.email]);const k=async t=>{if(t.preventDefault(),!r.hrEmail){y({title:"HR Query",message:"Please select an HR to send your query to.",type:"warning",ttl:4e3});return}try{const l=await A({category:r.category,subject:r.subject,description:r.description,urgency:r.urgency,hrEmail:r.hrEmail});y({title:"HR Query Submitted",message:`Your HR query #${l.id} has been submitted to ${r.hrEmail}.`,type:"success",link:"/employee/lcrm/hr-query",audience:`user:${((a==null?void 0:a.email)||"").toLowerCase()}`}),await u(),o({category:"leave",subject:"",description:"",urgency:"normal",hrEmail:""}),f(!1)}catch(l){y({title:"HR Query",message:(l==null?void 0:l.message)||"Failed to submit query. Please try again.",type:"error",ttl:6e3})}},B=t=>{switch(t){case"submitted":return"#ffc107";case"in-progress":return"#007bff";case"resolved":return"#28a745";case"closed":return"#6c757d";default:return"#6c757d"}};return e.jsxs("div",{className:"dashboard fade-in",children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"20px"},children:[e.jsxs("h2",{children:["ðŸ‘¥ HR Query - ",S]}),e.jsxs("div",{children:[e.jsx("button",{className:"btn btn-primary",onClick:()=>f(!x),style:{marginRight:"10px"},children:x?"Cancel":"+ Submit Query"}),e.jsx("button",{className:"btn btn-secondary",onClick:u,style:{marginRight:"8px"},children:"â†» Refresh"}),e.jsx("button",{className:"btn btn-secondary",onClick:()=>g("/employee/lcrm/admin-query"),style:{marginRight:"8px"},children:"â†’ Move to Admin Query"}),e.jsx("button",{className:"btn btn-secondary",onClick:()=>g(-1),children:"â† Back to ICRM"})]})]}),x&&e.jsxs("div",{className:"dashboard-card",style:{marginBottom:"20px"},children:[e.jsx("h3",{children:"ðŸ“ Submit HR Query"}),e.jsxs("form",{onSubmit:k,style:{textAlign:"left"},children:[e.jsxs("div",{style:{marginBottom:"15px"},children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"5px"},children:[e.jsx("label",{style:{fontWeight:"bold"},children:"Select HR:"}),e.jsxs("div",{style:{display:"flex",gap:8,alignItems:"center"},children:[E&&e.jsx("span",{style:{fontSize:12,color:"#6b7280"},children:"Loadingâ€¦"}),e.jsx("button",{type:"button",className:"btn-outline",style:{padding:"4px 8px"},onClick:async()=>{try{c(!0),p("");const t=await h();v(Array.isArray(t)?t:[])}catch(t){p((t==null?void 0:t.message)||"Failed to refresh HR list")}finally{c(!1)}},children:"Refresh"})]})]}),R&&e.jsx("div",{style:{color:"#dc2626",fontSize:12,marginBottom:6},children:R}),C.length>0?e.jsxs("select",{value:r.hrEmail,onChange:t=>o({...r,hrEmail:t.target.value}),required:!0,style:{width:"100%",padding:"8px",borderRadius:"4px",border:"1px solid #ddd"},children:[e.jsx("option",{value:"",children:"-- Choose HR --"}),C.map(t=>e.jsx("option",{value:t.email,children:`${t.firstName||""} ${t.lastName||""}`.trim()||t.username||t.email},t.email))]}):e.jsx("input",{type:"email",value:r.hrEmail,onChange:t=>o({...r,hrEmail:t.target.value}),required:!0,placeholder:"Enter HR email (no HR users found)",style:{width:"100%",padding:"8px",borderRadius:"4px",border:"1px solid #ddd"}})]}),e.jsxs("div",{style:{marginBottom:"15px"},children:[e.jsx("label",{style:{display:"block",marginBottom:"5px",fontWeight:"bold"},children:"Category:"}),e.jsxs("select",{value:r.category,onChange:t=>o({...r,category:t.target.value}),style:{width:"100%",padding:"8px",borderRadius:"4px",border:"1px solid #ddd"},children:[e.jsx("option",{value:"leave",children:"Leave & Attendance"}),e.jsx("option",{value:"benefits",children:"Benefits & Insurance"}),e.jsx("option",{value:"payroll",children:"Payroll & Compensation"}),e.jsx("option",{value:"policy",children:"Company Policies"}),e.jsx("option",{value:"training",children:"Training & Development"}),e.jsx("option",{value:"grievance",children:"Grievance & Complaints"}),e.jsx("option",{value:"other",children:"Other"})]})]}),e.jsxs("div",{style:{marginBottom:"15px"},children:[e.jsx("label",{style:{display:"block",marginBottom:"5px",fontWeight:"bold"},children:"Urgency:"}),e.jsxs("select",{value:r.urgency,onChange:t=>o({...r,urgency:t.target.value}),style:{width:"100%",padding:"8px",borderRadius:"4px",border:"1px solid #ddd"},children:[e.jsx("option",{value:"low",children:"Low"}),e.jsx("option",{value:"normal",children:"Normal"}),e.jsx("option",{value:"high",children:"High"}),e.jsx("option",{value:"urgent",children:"Urgent"})]})]}),e.jsxs("div",{style:{marginBottom:"15px"},children:[e.jsx("label",{style:{display:"block",marginBottom:"5px",fontWeight:"bold"},children:"Subject:"}),e.jsx("input",{type:"text",value:r.subject,onChange:t=>o({...r,subject:t.target.value}),required:!0,style:{width:"100%",padding:"8px",borderRadius:"4px",border:"1px solid #ddd"},placeholder:"Brief description of your query"})]}),e.jsxs("div",{style:{marginBottom:"15px"},children:[e.jsx("label",{style:{display:"block",marginBottom:"5px",fontWeight:"bold"},children:"Description:"}),e.jsx("textarea",{value:r.description,onChange:t=>o({...r,description:t.target.value}),required:!0,rows:"4",style:{width:"100%",padding:"8px",borderRadius:"4px",border:"1px solid #ddd"},placeholder:"Detailed description of your query or concern"})]}),e.jsx("button",{type:"submit",className:"btn btn-primary",children:"Submit Query"})]})]}),e.jsxs("div",{className:"dashboard-grid",children:[e.jsxs("div",{className:"dashboard-card",style:{gridColumn:"span 2"},children:[e.jsx("h3",{children:"ðŸ“‹ My HR Queries"}),e.jsx("div",{style:{textAlign:"left"},children:j.length===0?e.jsx("p",{children:'No queries found. Click "Submit Query" to ask your first HR question.'}):j.map(t=>e.jsxs("div",{style:{border:"1px solid #ddd",borderRadius:"8px",padding:"15px",marginBottom:"15px",backgroundColor:"#f9f9f9"},children:[e.jsxs("div",{style:{display:"flex",justifyContent:"space-between",alignItems:"center",marginBottom:"10px"},children:[e.jsxs("h4",{style:{margin:0,color:"#333"},children:["#",t.id," - ",t.subject]}),e.jsx("span",{style:{padding:"4px 8px",borderRadius:"4px",fontSize:"12px",fontWeight:"bold",backgroundColor:B(t.status),color:"white"},children:t.status.toUpperCase()})]}),e.jsxs("p",{style:{margin:"5px 0",color:"#666"},children:[e.jsx("strong",{children:"Category:"})," ",t.category," | ",e.jsx("strong",{children:"Date:"})," ",t.date]}),t.response&&e.jsxs("div",{style:{marginTop:"10px",padding:"10px",backgroundColor:"#e8f5e8",borderRadius:"4px",borderLeft:"4px solid #28a745"},children:[e.jsx("strong",{children:"HR Response:"}),e.jsx("p",{style:{margin:"5px 0 0 0"},children:t.response})]})]},t.id))})]}),e.jsxs("div",{className:"dashboard-card",children:[e.jsx("h3",{children:"ðŸ“ž Quick Contacts"}),e.jsxs("div",{style:{textAlign:"left"},children:[e.jsxs("p",{children:[e.jsx("strong",{children:"HR Helpdesk:"})," ext. 1234"]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Email:"})," hr@company.com"]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Office Hours:"})," 9:00 AM - 6:00 PM"]}),e.jsxs("p",{children:[e.jsx("strong",{children:"Emergency Contact:"})," ext. 911"]})]})]})]})]})}export{W as default};

import{M as Xe,F as f,E as n}from"./vendor-AZjfysqh.js";import{u as Ze,g as Ue}from"./index-CcBKZM2H.js";import{i as K}from"./holidays-BHBlvUOY.js";import"./router-CieCW4vl.js";function rt(){const{users:Q,currentUser:l,minuteTick:G,getAllAttendanceOverview:X,logAttendance:Ee,getAttendanceByDate:de,getAttendanceForUser:Y}=Ze(),le=Xe(),[R,ce]=f.useState([]),m=f.useMemo(()=>{const e=Array.isArray(Q)?Q:[];if(e.length>0)return e;try{const t=localStorage.getItem("erpUsers"),r=t?JSON.parse(t):[];return Array.isArray(r)?r:[]}catch{return[]}},[Q]),ke=()=>{const e=new Date,t=e.getFullYear(),r=String(e.getMonth()+1).padStart(2,"0"),o=String(e.getDate()).padStart(2,"0");return`${t}-${r}-${o}`},[u,Z]=f.useState(ke()),[C,Re]=f.useState(new Date().toISOString().slice(0,7)),[Be,pe]=f.useState([]),[H,Ie]=f.useState(0),[U,ge]=f.useState({}),[ee,me]=f.useState({}),[Pe,te]=f.useState([]),[D,ne]=f.useState(""),[E,O]=f.useState("Present"),[he,W]=f.useState("09:00:00"),[se,Ye]=f.useState(!1),[xe,B]=f.useState(!1),[fe,ye]=f.useState("");((l==null?void 0:l.role)||"").toLowerCase(),Ue(l||{});const ae=(e="")=>String(e||"").trim().replace(/\s+/g," ").toLowerCase(),oe=e=>{const t=ae(e);return t.replace(/\s+/g,"").includes("hrbplead")||t.includes("hrbp")&&t.includes("lead")},F=oe((l==null?void 0:l.designation)||(l==null?void 0:l.position)||""),ue=(()=>{const e=ae((l==null?void 0:l.designation)||(l==null?void 0:l.position)||"");return e.replace(/\s+/g,"")==="hrbp"||e.includes("hrbp")&&!oe(e)})(),A=(e="")=>String(e||"").trim().toLowerCase(),He=(e={})=>`${String((e==null?void 0:e.firstName)||"").trim()} ${String((e==null?void 0:e.lastName)||"").trim()}`.trim().toLowerCase(),re=(e=[])=>{const t=A(l==null?void 0:l.email),r=He(l);if(!t&&!r)return[];const o=s=>{const d=String(s??"").trim();if(!d)return!1;const p=d.toLowerCase().replace(/\s+/g," ").trim(),g=t&&(p===t||p.includes(t)),h=r&&(p===r||p.includes(r)||r.includes(p));return g||h};return(e||[]).filter(s=>{const d=String((s==null?void 0:s.role)||"").toLowerCase();return d!=="admin"&&d!=="teamlead"}).filter(s=>{const d=A(s==null?void 0:s.teamLeadEmail);return t&&d&&d===t?!0:[s==null?void 0:s.reportingTo,s==null?void 0:s.reporting_to,s==null?void 0:s.reportingToEmail,s==null?void 0:s.reporting_to_email,s==null?void 0:s.managerEmail,s==null?void 0:s.manager,s==null?void 0:s["Reporting To"],s==null?void 0:s.ReportingTo,s==null?void 0:s.ReportingToEmail].some(o)})},be=(e=[])=>(e||[]).filter(t=>{const r=m.find(a=>A(a==null?void 0:a.email)===A(t==null?void 0:t.email));if(!r)return!1;const o=ae((r==null?void 0:r.designation)||(r==null?void 0:r.position)||"");return!o||oe(o)?!1:o.includes("hrbp")||o.includes("hr recruiter")||o.includes("it recruiter")||o.includes("developer")}),Oe=m.some(e=>(e.teamLeadEmail||"").toLowerCase()===((l==null?void 0:l.email)||"").toLowerCase()),k=((l==null?void 0:l.designation)||"").toLowerCase()==="team lead"||Oe||F||ue,L=((l==null?void 0:l.role)||"").toLowerCase()==="admin",Se=e=>{try{const t=m.find(a=>(a.email||"").toLowerCase()===String(e||"").toLowerCase()),r=String((t==null?void 0:t.designation)||"").toLowerCase(),o=String((t==null?void 0:t.department)||"").toLowerCase();return r==="developer"||r.includes("developer")||o==="it"}catch{return!1}},I=(e,t)=>{const o=(t instanceof Date?t:new Date(t)).getDay();return Se(e)?o===0||o===6:o===3};f.useEffect(()=>{const e=m.length>0?m.map(o=>({email:o.email,username:o.username,attendance:Array.isArray(o.attendance)?o.attendance:[]})):X(),t=e.filter(o=>{var a;return(((a=m.find(s=>s.email===o.email))==null?void 0:a.role)||"").toLowerCase()==="employee"});e.filter(o=>{const a=m.find(i=>i.email===o.email);if(!a)return!1;const s=(a.role||"").toLowerCase(),d=(a.designation||"").toLowerCase();return s==="teamlead"||d==="team lead"});let r=t;if(k)if(F||ue){const o=re(m),a=new Set(o.map(s=>A(s==null?void 0:s.email)).filter(Boolean));r=e.filter(s=>a.has(A(s==null?void 0:s.email))),r.length===0&&(r=be(e))}else r=e.filter(o=>{const a=m.find(y=>y.email===o.email);if(!a||!((a.teamLeadEmail||"").toLowerCase()===((l==null?void 0:l.email)||"").toLowerCase()))return!1;const d=(a.role||"").toLowerCase(),i=(a.designation||"").toLowerCase(),p=(a.department||"").toLowerCase(),g=d==="employee",h=i==="hr"||i.includes("hr executive")||i.includes("hr manager")||i.includes("it recruiter")||p==="hr",w=i==="developer"||i.includes("developer")||i.includes("java developer");return(g||h)&&!w});else L?r=e.filter(o=>{const a=m.find(w=>w.email===o.email);if(!a)return!1;const s=(a.role||"").toLowerCase(),d=(a.designation||"").toLowerCase(),i=(a.department||"").toLowerCase(),p=s==="teamlead"||d==="team lead",g=d==="hr"||d.includes("hr executive")||d.includes("hr manager")||d.includes("it recruiter")||i==="hr",h=d==="developer"||d.includes("developer")||d.includes("java developer");return p||g||h}):r=[];ce(r);try{const o=JSON.parse(localStorage.getItem("leaveRequests")||"[]");pe(Array.isArray(o)?o:[])}catch{pe([])}},[m,X,l,k,L,H,G]),f.useEffect(()=>{const e=()=>Ie(t=>t+1);return window.addEventListener("erp-attendance-updated",e),window.addEventListener("storage",e),()=>{window.removeEventListener("erp-attendance-updated",e),window.removeEventListener("storage",e)}},[]),f.useEffect(()=>{(async()=>{try{const t=await de(u),r={};(t||[]).forEach(o=>{r[(o.email||"").toLowerCase()]=o}),ge(r)}catch{ge({})}})()},[u,de,H,G]),f.useEffect(()=>{(async()=>{try{const t=R.map(s=>(s.email||"").toLowerCase()),r=await Promise.all(t.map(s=>Y(s).then(d=>({e:s,rows:Array.isArray(d)?d:[]})).catch(()=>({e:s,rows:[]})))),o=String(C||"").slice(0,7),a={};r.forEach(({e:s,rows:d})=>{a[s]=d.filter(i=>String(i.date||"").slice(0,7)===o)}),me(a)}catch{me({})}})()},[R,C,Y,H,G]),f.useEffect(()=>{(async()=>{try{if(!D){te([]);return}const t=await Y(D),r=Array.isArray(t)?t.slice().sort((o,a)=>String(a.date||"").localeCompare(String(o.date||""))).slice(0,30):[];te(r)}catch{te([])}})()},[D,Y,H]);const we=(()=>{if(L)return m.filter(t=>{const r=(t.role||"").toLowerCase(),o=(t.designation||"").toLowerCase(),a=(t.department||"").toLowerCase(),s=o==="hr"||o.includes("hr executive")||o.includes("hr manager")||o.includes("it recruiter")||a==="hr",d=r==="manager"||o==="team lead",i=o==="developer"||o.includes("developer")||o.includes("java developer");return s||d||i});if(!k)return[];const e=m.filter(t=>(t.role||"").toLowerCase()==="employee");return F?re(m):e.filter(t=>(t.teamLeadEmail||"").toLowerCase()===((l==null?void 0:l.email)||"").toLowerCase())})(),ve=(()=>{const e=(fe||"").toLowerCase().trim();return e?we.filter(t=>{const r=(t.empId||"").toLowerCase(),o=`${t.firstName||""} ${t.lastName||""}`.toLowerCase(),a=(t.email||"").toLowerCase();return r.includes(e)||o.includes(e)||a.includes(e)}):we})(),z=e=>{try{if(!e)return 0;const t=e.split(":"),r=Number(t[0]||0),o=Number(t[1]||0),a=Number(t[2]||0);return r+o/60+a/3600}catch{return 0}},je=(e,t)=>{const r=(e||"").toLowerCase(),o=typeof t=="string"?t.slice(0,10):new Date(t).toISOString().slice(0,10);if(o===String(u).slice(0,10)){const i=U[r];if(!i)return null;const p=z(String(i.hours||"0:00:00"));return i.status==="Absent"||i.status==="Leave"?0:p}const s=(ee[r]||[]).find(i=>String(i.date||"").slice(0,10)===o);if(!s)return null;const d=z(String(s.hours||"0:00:00"));return s.status==="Absent"||s.status==="Leave"?0:d},$=e=>{if(typeof e=="string"&&e.includes(":")){const d=e.split(":"),i=w=>String(Number(w)||0).padStart(2,"0"),p=i(d[0]),g=i(d[1]??"0"),h=i(d[2]??"0");return`${p}:${g}:${h}`}const t=Number(e||0);if(!isFinite(t))return"00:00:00";const r=Math.max(0,Math.round(t*3600)),o=String(Math.floor(r/3600)).padStart(2,"0"),a=String(Math.floor(r%3600/60)).padStart(2,"0"),s=String(r%60).padStart(2,"0");return`${o}:${a}:${s}`},We=e=>{if(e.preventDefault(),!D){alert("Please select an employee");return}if(I(D,new Date(u))){alert(Se(D)?"Saturday/Sunday are weekly off for Developers.":"Wednesday is a weekly off.");return}const t=a=>a instanceof Date?a.toISOString().slice(0,10):String(a).slice(0,10);if(!(t(u)<t(new Date))&&String(E)!=="Leave"){alert("You can update attendance only for past dates (except Leave).");return}let o=z(he);(E==="Absent"||E==="Leave")&&(o=0),Ee({email:D,date:u,status:E,hours:o}),alert(`Saved ${E} (${$(o)} hh:mm:ss) for ${u}`),setTimeout(()=>{const a=m.length>0?m.map(i=>({email:i.email,username:i.username,attendance:Array.isArray(i.attendance)?i.attendance:[]})):X(),s=a.filter(i=>{var p;return(((p=m.find(g=>g.email===i.email))==null?void 0:p.role)||"").toLowerCase()==="employee"});let d=s;if(k)if(F){const i=re(m),p=new Set(i.map(g=>A(g==null?void 0:g.email)).filter(Boolean));d=a.filter(g=>p.has(A(g==null?void 0:g.email))),d.length===0&&(d=be(a))}else d=s.filter(i=>{var p;return(((p=m.find(g=>g.email===i.email))==null?void 0:p.teamLeadEmail)||"").toLowerCase()===((l==null?void 0:l.email)||"").toLowerCase()});else L?d=a.filter(i=>{const p=m.find(w=>w.email===i.email);if(!p)return!1;const g=(p.role||"").toLowerCase(),h=(p.designation||"").toLowerCase();return g==="teamlead"||h==="team lead"}):d=[];ce(d);try{window.dispatchEvent(new Event("erp-attendance-updated"))}catch{}},0)},Fe=(e,t)=>{const r=e.map(d=>d.map(i=>`"${i}"`).join(",")).join(`
`),o=new Blob([r],{type:"text/csv;charset=utf-8;"}),a=document.createElement("a"),s=URL.createObjectURL(o);a.setAttribute("href",s),a.setAttribute("download",`${t}.csv`),a.style.visibility="hidden",document.body.appendChild(a),a.click(),document.body.removeChild(a)},ze=()=>{const t=[["Employee","Department","Working Days","Present Days","Leave Days","Absent Days","Attendance Rate","Avg Time/Day"]];R.forEach(o=>{const a=m.find(d=>d.email===o.email),s=Le(o.email,C);t.push([`${a==null?void 0:a.firstName} ${a==null?void 0:a.lastName}`,(a==null?void 0:a.department)||"Not specified",s.totalWorkingDays,s.presentDays,s.leaveDays,s.absentDays,`${s.attendanceRate}%`,$(s.avgHours)])});const r=new Date(C+"-01").toLocaleDateString("en-US",{month:"long",year:"numeric"});Fe(t,`Team_Attendance_Overview_${r.replace(" ","_")}`)},J=(e,t)=>{const r=m.find(y=>y.email===e),o=new Date(t),a=new Date,s=I(e,o),d=K(`${o.getFullYear()}-${String(o.getMonth()+1).padStart(2,"0")}-${String(o.getDate()).padStart(2,"0")}`),i=y=>{if(!y)return"";if(typeof y=="string"&&y.length===10)return y;const M=y instanceof Date?y:new Date(y),Ae=M.getFullYear(),ie=String(M.getMonth()+1).padStart(2,"0"),q=String(M.getDate()).padStart(2,"0");return`${Ae}-${ie}-${q}`};if(!r)return"Not Marked";const p=(r==null?void 0:r.dateOfJoining)||"";if(p&&i(o)<i(p))return"Not Marked";const g=typeof t=="string"?t.slice(0,10):new Date(t).toISOString().slice(0,10);if(g===i(o)){const y=U[(e||"").toLowerCase()];if(y)return y.status}const w=(ee[(e||"").toLowerCase()]||[]).find(y=>String(y.date||"").slice(0,10)===g);return w?w.status:s?"Week Off":d?"Holiday":i(o)<i(a)?"Absent":"Not Marked"},De=e=>{try{const t=Number(localStorage.getItem(`erpPresence_${e}`)||0);return t?Date.now()-t<3*60*1e3:!1}catch{return!1}},_=e=>e instanceof Date?e.toISOString().slice(0,10):String(e).slice(0,10),Le=(e,t)=>{const o=(ee[(e||"").toLowerCase()]||[]).filter(c=>String(c.date||"").slice(0,7)===String(t).slice(0,7)),[a,s]=String(t).split("-").map(Number),d=new Date(a,s,0).getDate();let p=(()=>{let c=0;for(let x=1;x<=d;x++){const S=new Date(a,s-1,x),b=`${a}-${String(s).padStart(2,"0")}-${String(x).padStart(2,"0")}`,v=K(b);!I(e,S)&&!v&&c++}return c})();const g=m.find(c=>(c.email||"").toLowerCase()===(e||"").toLowerCase()),h=(()=>{const c=g==null?void 0:g.dateOfJoining;if(!c)return null;const x=String(c);if(/^\d{4}-\d{2}-\d{2}$/.test(x)){const[b,v,j]=x.split("-").map(Number);return new Date(b,(v||1)-1,j||1)}const S=new Date(c);return isNaN(S.getTime())?null:S})();if(h){const c=h.getFullYear(),x=h.getMonth()+1;if(c>a||c===a&&x>s)p=0;else if(c===a&&x===s){let S=0;for(let b=h.getDate();b<=d;b++){const v=new Date(a,s-1,b),j=`${a}-${String(s).padStart(2,"0")}-${String(b).padStart(2,"0")}`,V=K(j);!I(e,v)&&!V&&S++}p=S}}const w=o.filter(c=>String(c.status).toLowerCase()==="present").length,y=o.filter(c=>String(c.status).toLowerCase()==="leave").length,M=new Date,ie=M.getFullYear()===a&&M.getMonth()+1===s?M.getDate():d,q=(()=>{let c=0,x=1;h&&h.getFullYear()===a&&h.getMonth()+1===s&&(x=h.getDate());for(let S=x;S<=ie;S++){const b=new Date(a,s-1,S),v=`${a}-${String(s).padStart(2,"0")}-${String(S).padStart(2,"0")}`,j=K(v);!I(e,b)&&!j&&c++}return c})(),Je=(c=>`${c.getFullYear()}-${String(c.getMonth()+1).padStart(2,"0")}-${String(c.getDate()).padStart(2,"0")}`)(M),Me=o.filter(c=>String(c.date||"").slice(0,10)<=Je),_e=Me.filter(c=>String(c.status).toLowerCase()==="present").length,qe=Me.filter(c=>String(c.status).toLowerCase()==="leave").length,Ve=Math.max(0,q-_e-qe);let Ne=o.reduce((c,x)=>String(x.status).toLowerCase()!=="present"?c:c+z(String(x.hours||"0:00:00")),0);try{const c=new Date,x=c.toISOString().slice(0,7);if(String(t).slice(0,7)===x){const b=(T=>{const P=T instanceof Date?T:new Date(T);return`${P.getFullYear()}-${String(P.getMonth()+1).padStart(2,"0")}-${String(P.getDate()).padStart(2,"0")}`})(c),v=o.find(T=>String(T.date||"").slice(0,10)===b),j=J(e,b),V=String(j).toLowerCase()==="present"||String(j).toLowerCase()==="logged in",N=!!v;if(V){const T=localStorage.getItem("erpLoginTime"),P=localStorage.getItem("erpLoginDate"),$e=localStorage.getItem("erpPresence");if(((l==null?void 0:l.email)||"").toLowerCase()===(e||"").toLowerCase()&&T&&P===b&&$e&&$e.toLowerCase()!=="loggedout"){const Qe=new Date(T),Ge=Math.max(0,Math.floor((c-Qe)/6e4));Ne+=Ge/60}}}}catch{}(()=>{try{const c=new Date,x=c.toISOString().slice(0,7);if(String(t).slice(0,7)!==x)return 0;const b=(N=>`${N.getFullYear()}-${String(N.getMonth()+1).padStart(2,"0")}-${String(N.getDate()).padStart(2,"0")}`)(c),v=o.some(N=>String(N.date||"").slice(0,10)===b&&String(N.status).toLowerCase()==="present"),j=J(e,b);return(String(j).toLowerCase()==="present"||String(j).toLowerCase()==="logged in")&&!v?1:0}catch{return 0}})();const Te=Math.max(0,q),Ke=Te>0?Math.round(Ne/Te*100)/100:0;return{totalWorkingDays:p,presentDays:w,leaveDays:y,absentDays:Ve,attendanceRate:p>0?Math.round(w/p*100):0,avgHours:Ke}};Be.filter(e=>e.status==="Pending");const Ce=()=>{(l==null?void 0:l.role)==="admin"?le("/admin/dashboard"):le("/")};return!k&&!L?n.jsxs("div",{className:"dashboard fade-in",style:{padding:20},children:[n.jsxs("div",{className:"dashboard-header",children:[n.jsx("div",{children:n.jsx("h2",{children:"ðŸ“Š Team Attendance"})}),n.jsx("button",{className:"btn-outline back-to-dashboard",onClick:Ce,children:"â† Back to Home"})]}),n.jsx("div",{className:"card",style:{padding:16,marginTop:12},children:n.jsx("p",{style:{margin:0},children:"You don't have a Team Lead assignment. Please sign in as a Team Lead to view your team."})})]}):n.jsxs("div",{className:"dashboard fade-in",children:[n.jsxs("div",{className:"dashboard-header",children:[n.jsxs("div",{children:[n.jsxs("h2",{children:["ðŸ“Š ",L?"Team Leads Attendance":"Team Attendance"]}),n.jsx("p",{children:L?"View attendance records for Team Leads.":"Monitor and manage team attendance records."})]}),n.jsx("button",{className:"btn-outline back-to-dashboard",onClick:Ce,children:"â† Back to Home"})]}),n.jsxs("div",{style:{display:"flex",alignItems:"flex-end",gap:"20px",flexWrap:"wrap",marginBottom:"20px"},children:[n.jsxs("div",{style:{display:"flex",flexDirection:"column"},children:[n.jsx("label",{style:{marginBottom:"5px",fontSize:"14px",fontWeight:"bold"},children:"Select Date (for daily actions):"}),n.jsx("input",{type:"date",value:u,onChange:e=>Z(e.target.value),style:{padding:"8px",border:"1px solid #ddd",borderRadius:"4px"}})]}),n.jsxs("div",{style:{display:"flex",flexDirection:"column"},children:[n.jsx("label",{style:{marginBottom:"5px",fontSize:"14px",fontWeight:"bold"},children:"Select Month (for overview):"}),n.jsx("input",{type:"month",value:C,onChange:e=>Re(e.target.value),style:{padding:"8px",border:"1px solid #ddd",borderRadius:"4px"}})]}),n.jsxs("div",{style:{display:"flex",flexDirection:"column"},children:[n.jsx("label",{style:{marginBottom:"5px",fontSize:"14px",fontWeight:"bold"},children:"Day-wise Preview"}),n.jsxs("label",{style:{display:"flex",alignItems:"center",gap:8},children:[n.jsx("input",{type:"checkbox",checked:se,onChange:e=>Ye(e.target.checked)}),n.jsx("span",{children:"Show Selected Date Table"})]})]})]}),(k||L)&&n.jsxs("div",{className:"dashboard-card",style:{padding:16,marginBottom:16,borderRadius:10},children:[n.jsx("h3",{style:{marginTop:0,marginBottom:10},children:"Manual Attendance Update"}),n.jsxs("form",{onSubmit:We,style:{display:"grid",gridTemplateColumns:"repeat(auto-fit, minmax(200px, 1fr))",gap:12},children:[n.jsxs("div",{style:{position:"relative"},children:[n.jsx("div",{role:"button",tabIndex:0,onClick:()=>{B(e=>!e),ye("")},onKeyDown:e=>{(e.key==="Enter"||e.key===" ")&&(e.preventDefault(),B(t=>!t))},style:{padding:"8px",border:"1px solid #ddd",borderRadius:6,background:"#fff",cursor:"pointer"},"aria-expanded":xe,"aria-haspopup":"listbox",children:(()=>{const e=m.find(t=>t.email===D);return e?`${e.empId||"N/A"} - ${(e.firstName||"")+" "+(e.lastName||"")}`.trim():"Select EMP ID"})()}),xe&&n.jsxs("div",{style:{position:"absolute",zIndex:20,top:"100%",marginTop:4,left:0,right:0,width:"100%",background:"#fff",border:"1px solid #e5e7eb",borderRadius:8,boxShadow:"0 10px 20px rgba(0,0,0,0.12)",padding:8,boxSizing:"border-box"},children:[n.jsx("input",{autoFocus:!0,type:"text",value:fe,onChange:e=>ye(e.target.value),onKeyDown:e=>{e.key==="Escape"&&(e.stopPropagation(),B(!1))},placeholder:"Search EMP ID / Name / Email",style:{width:"100%",padding:"8px",border:"1px solid #ddd",borderRadius:6,marginBottom:6,boxSizing:"border-box",display:"block"}}),n.jsx("div",{role:"listbox",style:{maxHeight:220,overflowY:"auto"},children:ve.length===0?n.jsx("div",{style:{padding:8,color:"#6b7280"},children:"No results"}):ve.map(e=>n.jsxs("div",{role:"option",onClick:()=>{ne(e.email),B(!1)},onKeyDown:t=>{t.key==="Enter"&&(ne(e.email),B(!1))},tabIndex:0,style:{padding:"8px",borderRadius:6,cursor:"pointer"},onMouseDown:t=>t.preventDefault(),children:[n.jsx("div",{style:{fontWeight:600},children:e.empId||"N/A"}),n.jsxs("div",{style:{fontSize:12,color:"#6b7280"},children:[`${e.firstName||""} ${e.lastName||""}`.trim()," Â· ",e.email]})]},e.email))})]})]}),n.jsx("input",{type:"date",value:u,onChange:e=>Z(e.target.value)}),n.jsxs("select",{value:E,onChange:e=>O(e.target.value),children:[n.jsx("option",{children:"Present"}),n.jsx("option",{children:"Absent"}),n.jsx("option",{children:"Leave"})]}),n.jsx("input",{type:"time",step:"1",value:he,onChange:e=>W(e.target.value),placeholder:"HH:MM:SS"}),n.jsxs("div",{style:{display:"flex",gap:8,alignItems:"center"},children:[n.jsx("button",{type:"submit",className:"btn-primary",children:"Save"}),n.jsx("button",{type:"button",className:"btn-outline",onClick:()=>{O("Present"),W("09:00:00")},children:"Reset"})]})]}),D?n.jsxs("div",{style:{marginTop:12},children:[n.jsx("h4",{style:{margin:"8px 0"},children:"Recent Attendance (Last 30 entries)"}),n.jsxs("table",{className:"attendance-table",style:{width:"100%",borderCollapse:"collapse"},children:[n.jsx("thead",{children:n.jsxs("tr",{style:{background:"#f5f5f5"},children:[n.jsx("th",{style:{padding:8,border:"1px solid #ddd",textAlign:"left"},children:"Date"}),n.jsx("th",{style:{padding:8,border:"1px solid #ddd",textAlign:"left"},children:"Status"}),n.jsx("th",{style:{padding:8,border:"1px solid #ddd",textAlign:"left"},children:"Hours"}),n.jsx("th",{style:{padding:8,border:"1px solid #ddd",textAlign:"center"},children:"Edit"})]})}),n.jsx("tbody",{children:Pe.map(t=>n.jsxs("tr",{children:[n.jsx("td",{style:{padding:8,border:"1px solid #ddd"},children:(t.date||"").slice(0,10)}),n.jsx("td",{style:{padding:8,border:"1px solid #ddd"},children:t.status}),n.jsx("td",{style:{padding:8,border:"1px solid #ddd"},children:$(t.hours)}),n.jsx("td",{style:{padding:8,border:"1px solid #ddd",textAlign:"center"},children:n.jsx("button",{className:"btn-outline",onClick:()=>{Z((t.date||"").slice(0,10)),O(t.status),W($(t.hours))},children:"Prefill"})})]},`${t.date}`))})]})]}):null]}),se&&n.jsxs("div",{className:"attendance-overview",children:[n.jsxs("h3",{children:["Selected Date Attendance - ",u]}),n.jsxs("table",{className:"attendance-table",style:{width:"100%",borderCollapse:"collapse",marginTop:"12px"},children:[n.jsx("thead",{children:n.jsxs("tr",{style:{backgroundColor:"#f5f5f5",borderBottom:"2px solid #ddd"},children:[n.jsx("th",{style:{padding:"12px",textAlign:"left",border:"1px solid #ddd"},children:"Employee"}),n.jsx("th",{style:{padding:"12px",textAlign:"left",border:"1px solid #ddd"},children:"Department"}),n.jsx("th",{style:{padding:"12px",textAlign:"center",border:"1px solid #ddd"},children:"Status"}),n.jsx("th",{style:{padding:"12px",textAlign:"center",border:"1px solid #ddd"},children:"Login Time"}),n.jsx("th",{style:{padding:"12px",textAlign:"center",border:"1px solid #ddd"},children:"Logout Time"}),n.jsx("th",{style:{padding:"12px",textAlign:"center",border:"1px solid #ddd"},children:"Worked Hours"}),n.jsx("th",{style:{padding:"12px",textAlign:"center",border:"1px solid #ddd"},children:"Edit"})]})}),n.jsx("tbody",{children:R.map(e=>{const t=m.find(h=>h.email===e.email),r=U[(e.email||"").toLowerCase()],o=J(e.email,u),a=_(u)===_(new Date)&&De(e.email)?"Logged In":o,s=(r==null?void 0:r.loginTime)||"-",d=(r==null?void 0:r.logoutTime)||"-",i=je(e.email,u),p=i===null?null:Math.max(0,(Number(i)||0)-1),g=p===null?"-":$(p);return n.jsxs("tr",{style:{borderBottom:"1px solid #ddd"},children:[n.jsx("td",{style:{padding:"12px",border:"1px solid #ddd"},children:n.jsxs("strong",{children:[t==null?void 0:t.firstName," ",t==null?void 0:t.lastName]})}),n.jsx("td",{style:{padding:"12px",border:"1px solid #ddd"},children:(t==null?void 0:t.department)||"Not specified"}),n.jsx("td",{style:{padding:"12px",textAlign:"center",border:"1px solid #ddd"},children:n.jsx("span",{className:`status ${a.toLowerCase().replace(" ","-")}`,children:a})}),n.jsx("td",{style:{padding:"12px",textAlign:"center",border:"1px solid #ddd"},children:s}),n.jsx("td",{style:{padding:"12px",textAlign:"center",border:"1px solid #ddd"},children:d}),n.jsx("td",{style:{padding:"12px",textAlign:"center",border:"1px solid #ddd"},children:g}),n.jsx("td",{style:{padding:"12px",textAlign:"center",border:"1px solid #ddd"},children:n.jsx("button",{className:"btn-outline",onClick:()=>{ne(e.email),O(o);const h=je(e.email,u);W($(h||0))},children:"Prefill"})})]},`daily-${e.email}`)})})]})]}),!se&&n.jsxs("div",{className:"attendance-overview",children:[n.jsxs("h3",{children:[L?"Team Leads Attendance Overview":"Team Attendance Overview"," - ",new Date(C+"-01").toLocaleDateString("en-US",{month:"long",year:"numeric"})]}),n.jsxs("table",{className:"attendance-table",style:{width:"100%",borderCollapse:"collapse",marginTop:"20px"},children:[n.jsx("thead",{children:n.jsxs("tr",{style:{backgroundColor:"#f5f5f5",borderBottom:"2px solid #ddd"},children:[n.jsx("th",{style:{padding:"12px",textAlign:"left",border:"1px solid #ddd"},children:"Employee"}),n.jsx("th",{style:{padding:"12px",textAlign:"left",border:"1px solid #ddd"},children:"Department"}),n.jsx("th",{style:{padding:"12px",textAlign:"center",border:"1px solid #ddd"},children:"Working Days"}),n.jsx("th",{style:{padding:"12px",textAlign:"center",border:"1px solid #ddd"},children:"Present Days"}),n.jsx("th",{style:{padding:"12px",textAlign:"center",border:"1px solid #ddd"},children:"Leave Days"}),n.jsx("th",{style:{padding:"12px",textAlign:"center",border:"1px solid #ddd"},children:"Absent Days"}),n.jsx("th",{style:{padding:"12px",textAlign:"center",border:"1px solid #ddd"},children:"Attendance Rate"}),n.jsx("th",{style:{padding:"12px",textAlign:"center",border:"1px solid #ddd"},children:"Avg Time/Day"}),n.jsxs("th",{style:{padding:"12px",textAlign:"center",border:"1px solid #ddd"},children:[u," Status"]})]})}),n.jsx("tbody",{children:R.map(e=>{const t=m.find(i=>i.email===e.email),r=(()=>{const i=t==null?void 0:t.dateOfJoining;if(!i)return null;try{const p=new Date(i);return isNaN(p.getTime())?String(i).slice(0,7):p.toISOString().slice(0,7)}catch{return String(i).slice(0,7)}})();if(r?String(C).slice(0,7)<r:!1)return n.jsxs("tr",{style:{borderBottom:"1px solid #ddd"},children:[n.jsx("td",{style:{padding:"12px",border:"1px solid #ddd"},children:n.jsxs("strong",{children:[t==null?void 0:t.firstName," ",t==null?void 0:t.lastName]})}),n.jsx("td",{style:{padding:"12px",border:"1px solid #ddd"},children:(t==null?void 0:t.department)||"Not specified"}),n.jsxs("td",{colSpan:8,style:{padding:"12px",border:"1px solid #ddd",color:"#334155"},children:["Attendance not available before employee's Date of Joining (",r,")."]})]},e.email);const a=Le(e.email,C),s=J(e.email,u),d=_(u)===_(new Date)&&De(e.email)?"Logged In":s;return n.jsxs("tr",{style:{borderBottom:"1px solid #ddd"},children:[n.jsx("td",{style:{padding:"12px",border:"1px solid #ddd"},children:n.jsxs("strong",{children:[t==null?void 0:t.firstName," ",t==null?void 0:t.lastName]})}),n.jsx("td",{style:{padding:"12px",border:"1px solid #ddd"},children:(t==null?void 0:t.department)||"Not specified"}),n.jsx("td",{style:{padding:"12px",textAlign:"center",border:"1px solid #ddd"},children:a.totalWorkingDays}),n.jsx("td",{style:{padding:"12px",textAlign:"center",border:"1px solid #ddd"},children:n.jsx("span",{style:{color:"#28a745",fontWeight:"bold"},children:a.presentDays})}),n.jsx("td",{style:{padding:"12px",textAlign:"center",border:"1px solid #ddd"},children:n.jsx("span",{style:{color:"#ffc107"},children:a.leaveDays})}),n.jsx("td",{style:{padding:"12px",textAlign:"center",border:"1px solid #ddd"},children:n.jsx("span",{style:{color:"#dc3545"},children:a.absentDays})}),n.jsx("td",{style:{padding:"12px",textAlign:"center",border:"1px solid #ddd"},children:n.jsxs("span",{style:{color:a.attendanceRate>=90?"#28a745":a.attendanceRate>=75?"#ffc107":"#dc3545",fontWeight:"bold"},children:[a.attendanceRate,"%"]})}),n.jsx("td",{style:{padding:"12px",textAlign:"center",border:"1px solid #ddd"},children:$(a.avgHours)}),n.jsx("td",{style:{padding:"12px",textAlign:"center",border:"1px solid #ddd"},children:n.jsx("span",{className:`status ${d.toLowerCase().replace(" ","-")}`,children:d})})]},e.email)})})]}),n.jsx("div",{style:{marginTop:"20px",textAlign:"center"},children:n.jsx("button",{className:"btn-primary",onClick:ze,style:{padding:"10px 20px"},children:"ðŸ“Š Download Attendance Overview (Excel)"})})]})]})}export{rt as default};

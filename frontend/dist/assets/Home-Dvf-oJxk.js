import{M as fe,F as N,E as s}from"./vendor-AZjfysqh.js";import{C as ue}from"./calendar-DsO1VIqB.js";import{u as De,g as X}from"./index-CcBKZM2H.js";import{g as K}from"./holidays-BHBlvUOY.js";import"./router-CieCW4vl.js";function be(){const{currentUser:n,users:L,getAttendanceForUser:U,getMyLeaves:ee,getMyLeaveBalance:te,listUpdates:Q}=De(),W=fe(),[T,z]=N.useState(new Date),[C,q]=N.useState(new Date),[E,ae]=N.useState([]),[$,ne]=N.useState(null),[Y,se]=N.useState([]),[oe,le]=N.useState([]),[Z,I]=N.useState([]),G=()=>{try{const e=(L||[]).find(o=>(o.email||"").toLowerCase()===((n==null?void 0:n.email)||"").toLowerCase()),r=e==null?void 0:e.dateOfJoining;if(!r)return null;const i=String(r);if(/^\d{4}-\d{2}-\d{2}$/.test(i)){const[o,g,c]=i.split("-").map(Number);return new Date(o,(g||1)-1,c||1)}const m=new Date(r);return isNaN(m.getTime())?null:m}catch{return null}},re=()=>String((n==null?void 0:n.designation)||"").toLowerCase().includes("developer"),J=e=>{const r=(e instanceof Date?e:new Date(e)).getDay();return re()?r===0||r===6:r===3},V=(e,r)=>{let i=0;const m=K(e,r).map(c=>c.date),o=new Date(e,r,1),g=G();for(;o.getMonth()===r;){const c=`${o.getFullYear()}-${String(o.getMonth()+1).padStart(2,"0")}-${String(o.getDate()).padStart(2,"0")}`,h=J(o),u=m.includes(c),v=g?o<new Date(g.getFullYear(),g.getMonth(),g.getDate()):!1;!h&&!u&&!v&&i++,o.setDate(o.getDate()+1)}return i},ie=e=>{const r=new Date(e),i=r.getDay(),m=(i===0?-6:1)-i,o=new Date(r);o.setDate(r.getDate()+m),o.setHours(0,0,0,0);const g=new Date(o);return g.setDate(o.getDate()+6),g.setHours(23,59,59,999),{start:o,end:g,key:(h=>`${h.getFullYear()}-${String(h.getMonth()+1).padStart(2,"0")}-${String(h.getDate()).padStart(2,"0")}`)(o)}},de=e=>{const r=new Date(e),i=e.getDay(),m=(i===0?-6:1)-i;r.setDate(e.getDate()+m);let o=0;const g=G();for(let c=0;c<7;c++){const h=new Date(r);h.setDate(r.getDate()+c);const u=`${h.getFullYear()}-${String(h.getMonth()+1).padStart(2,"0")}-${String(h.getDate()).padStart(2,"0")}`,v=K(h.getFullYear(),h.getMonth()).map(d=>d.date),t=J(h),S=v.includes(u),f=g?h<new Date(g.getFullYear(),g.getMonth(),g.getDate()):!1;!t&&!S&&!f&&o++}return o},P=async()=>{if(!(n!=null&&n.email))return;const e=new Date,r=e.getMonth()+1,i=e.getFullYear(),{start:m,end:o,key:g}=ie(e);let c=[];try{const a=await U(n.email);Array.isArray(a)&&(c=a)}catch(a){(a==null?void 0:a.status)===401||(a==null?void 0:a.status)===403?c=[]:c=[]}(()=>{if(!Array.isArray(Y)||Y.length!==c.length)return!1;for(let a=0;a<c.length;a++){const y=c[a]||{},A=Y[a]||{};if((y.id||y.date)!==(A.id||A.date)||String(y.status||"")!==String(A.status||"")||Number(y.hours||0)!==Number(A.hours||0))return!1}return!0})()||se(c);const u=a=>typeof a=="string"&&a.length>=10?a.slice(0,10):`${new Date(a).getFullYear()}-${String(new Date(a).getMonth()+1).padStart(2,"0")}-${String(new Date(a).getDate()).padStart(2,"0")}`,v=`${e.getFullYear()}-${String(e.getMonth()+1).padStart(2,"0")}`,t=`${m.getFullYear()}-${String(m.getMonth()+1).padStart(2,"0")}-${String(m.getDate()).padStart(2,"0")}`,S=`${o.getFullYear()}-${String(o.getMonth()+1).padStart(2,"0")}-${String(o.getDate()).padStart(2,"0")}`,f=c.filter(a=>u(a.date).slice(0,7)===v),d=c.filter(a=>{const y=u(a.date);return y>=t&&y<=S}),p=f.filter(a=>a.status==="Present").length,l=d.filter(a=>a.status==="Present").length,D=f.reduce((a,y)=>{const A=y.hours!=null?Number(y.hours):8;return a+(isNaN(A)?8:A)},0),w=Math.max(0,D-p*1);let k=[];try{k=await ee()}catch{k=[]}const M=(Array.isArray(k)?k:[]).filter(a=>String(a.status||"").toLowerCase()==="approved"),H=a=>a&&a.duration!=null?Math.max(.5,Number(a.duration)):Math.max(1,Math.ceil((new Date(String(a.to||"").slice(0,10))-new Date(String(a.from||"").slice(0,10)))/(1e3*60*60*24))+1);le(M.map(a=>({startDate:String(a.from||"").slice(0,10),endDate:String(a.to||"").slice(0,10),days:Math.max(1,Math.ceil((new Date(String(a.to||"").slice(0,10))-new Date(String(a.from||"").slice(0,10)))/(1e3*60*60*24))+1)})));const x=M.filter(a=>{const y=new Date(String(a.from||"").slice(0,10));return y.getMonth()===e.getMonth()&&y.getFullYear()===i}).reduce((a,y)=>a+H(y),0),j=M.filter(a=>new Date(String(a.from||"").slice(0,10)).getFullYear()===i).reduce((a,y)=>a+H(y),0),_=JSON.parse(localStorage.getItem(`erpHomeLeaves_${n.email}`)||"[]").filter(a=>{const y=new Date(a.date);return y.getMonth()===e.getMonth()&&y.getFullYear()===i});let R=18,F=18-j;try{const a=await te(i);a&&typeof a.remaining<"u"&&(F=Number(a.remaining),typeof a.annualAllowance<"u"&&(R=Number(a.annualAllowance)))}catch{}const O={year:i,month:r,weekKey:g,workingDays:V(i,e.getMonth()),daysWorked:p,weeklyWorkingDays:de(e),weeklyDaysWorked:l,hoursWorked:w,targetHoursPerMonth:V(i,e.getMonth())*8,leavesPerMonth:1.5,totalLeavesYearly:R,leavesTakenMonth:x,leavesTakenYearly:j,remainingMonthlyLeaves:Math.max(0,1.5-x),remainingYearlyLeaves:F,history:_};ne(O)};N.useEffect(()=>{P()},[n,L]),N.useEffect(()=>{n!=null&&n.email&&P()},[T]),N.useEffect(()=>{const e=()=>P(),r=()=>P();return window.addEventListener("erp-attendance-updated",e),window.addEventListener("erp-leaves-updated",r),window.addEventListener("storage",e),()=>{window.removeEventListener("erp-attendance-updated",e),window.removeEventListener("erp-leaves-updated",r),window.removeEventListener("storage",e)}},[n]),N.useEffect(()=>{const e=C instanceof Date?C:T;`${e.getFullYear()}${String(e.getMonth()+1).padStart(2,"0")}`,ae(K(e.getFullYear(),e.getMonth()))},[C,T]),N.useEffect(()=>{let e=!0;const r=async()=>{try{if(!n){I([]);return}const m=await Q();if(!e)return;I(Array.isArray(m)?m:[])}catch{if(!e)return;I([])}};r();const i=setInterval(r,3e4);return()=>{e=!1,clearInterval(i)}},[n,Q]);const b=e=>`${e.getFullYear()}-${String(e.getMonth()+1).padStart(2,"0")}-${String(e.getDate()).padStart(2,"0")}`,ce=({date:e,view:r})=>{var i,m;if(r==="month"){const o=b(e),g=b(T),c=b(new Date),h=J(e);if(o===c)return"today-tile";if(o===g)return"selected-tile";if(h)return"wednesday-off-tile";if(E.some(l=>l.date===o))return"holiday-tile";if(oe.some(l=>{const D=new Date(l.startDate),w=new Date(l.endDate),k=new Date(o);return k>=D&&k<=w}))return"approved-leave-tile";if((i=$==null?void 0:$.history)!=null&&i.some(l=>l.date===o))return"leave-tile";if(Y.some(l=>l!=null&&l.date?(typeof l.date=="string"&&l.date.length>=10?l.date.slice(0,10):b(new Date(l.date)))===o&&l.status==="Present":!1))return"present-tile";const t=o<c,S=(()=>{try{const l=(L||[]).find(w=>w.email===(n==null?void 0:n.email));if(!(l!=null&&l.dateOfJoining))return null;const D=new Date(l.dateOfJoining);return b(D)}catch{return null}})(),f=E.some(l=>l.date===o),d=Y.some(l=>l!=null&&l.date?(typeof l.date=="string"?l.date.slice(0,10):b(new Date(l.date)))===o:!1),p=(m=$==null?void 0:$.history)==null?void 0:m.some(l=>l.date===o);return t&&!h&&!f&&!d&&!p&&(!S||o>=S)?"lop-tile":"workingday-tile"}return null},me=({date:e,view:r})=>{if(r!=="month")return null;const i=b(e);return E.some(o=>o.date===i)?s.jsx("span",{className:"holiday-dot","aria-hidden":!0}):null},ge=()=>{const e=new Date;z(e),q(e)},he=()=>{const e=(X(n||{})||"").toLowerCase();W(`${e==="admin"?"/admin/leave-history":e==="teamlead"?"/teamlead/leave-requests":"/leave-request"}?section=holidays`)},pe=()=>{W("/leave-request")},ye=(()=>{const e=(X(n||{})||"").toLowerCase(),r=String((n==null?void 0:n.designation)||(n==null?void 0:n.position)||"").trim().toLowerCase(),i=r==="hrbp"||r==="hrbp lead",o=e==="hr"||r.includes("hr")||r.includes("recruiter");if(e==="admin")return[{label:"Performance Analytics",to:"/admin/performance-analytics",icon:"ðŸ“Š"},{label:"Reports",to:"/admin/reports",icon:"ðŸ“‘"},{label:"Payroll",to:"/admin/payroll",icon:"ðŸ’°"},{label:"Attendance",to:"/admin/attendance",icon:"ðŸ•’"},{label:"Policies",to:"/policies",icon:"ðŸ“œ"},{label:"Leave Requests",to:"/admin/leave-requests",icon:"ðŸ–ï¸"},{label:"Leave History",to:"/admin/leave-history",icon:"ðŸ“š"},{label:"Admin Query Inbox",to:"/admin/queries",icon:"ðŸ“®"},{label:"Team Management",to:"/admin/team-management",icon:"ðŸ‘¥"},{label:"Team Leads Attendance",to:"/admin/team-attendance",icon:"ðŸ•’"},{label:"Task Management",to:"/admin/task-management",icon:"ðŸ“‹"}];const u=[{label:"My Tasks",to:e==="hr"?"/hr/tasks":e==="teamlead"?"/teamlead/my-tasks":"/employee/tasks",icon:"ðŸ“"},{label:"Policies",to:"/policies",icon:"ðŸ“œ"},{label:"My Desk",to:e==="hr"?"/hr/mydesk":"/employee/mydesk",icon:"ðŸ“Š"},{label:"ICRM",to:e==="teamlead"?"/teamlead/lcrm":e==="hr"||i?"/hr/lcrm":"/employee/lcrm",icon:"ðŸŒ"},{label:"Leave History",to:"/leave-request",icon:"ðŸ–ï¸"}],v=o?[{label:"Updates",to:"/updates",icon:"ðŸ†•"}]:[];return e==="employee"?[...u,...v,{label:"Team Management",to:"/teamlead/team",icon:"ðŸ‘¥"},{label:"Team Attendance",to:"/teamlead/attendance",icon:"ðŸ•’"},{label:"Task Management",to:"/teamlead/tasks",icon:"ðŸ“‹"},{label:"Shift Extension",to:"/teamlead/shift-extensions",icon:"â±ï¸"},{label:"Lead Approval",to:"/teamlead/lead-approval",icon:"âœ…"}]:e==="hr"?[...u,...v,...i?[{label:"Recruitment",to:"/hr/recruitment",icon:"ðŸ§‘â€ðŸŽ“"},{label:"Team Performance",to:"/teamlead/performance",icon:"ðŸ“ˆ"}]:[{label:"Recruitment",to:"/hr/recruitment",icon:"ðŸ§‘â€ðŸŽ“"}],{label:"Team Management",to:"/teamlead/team",icon:"ðŸ‘¥"},{label:"Team Attendance",to:"/teamlead/attendance",icon:"ðŸ•’"},{label:"Task Management",to:"/teamlead/tasks",icon:"ðŸ“‹"},{label:"Shift Extension",to:"/teamlead/shift-extensions",icon:"â±ï¸"},{label:"Lead Approval",to:"/teamlead/lead-approval",icon:"âœ…"}]:e==="teamlead"?[...u,...v,{label:"Team Management",to:"/teamlead/team",icon:"ðŸ‘¥"},{label:"Team Attendance",to:"/teamlead/attendance",icon:"ðŸ•’"},{label:"Team Performance",to:"/teamlead/performance",icon:"ðŸ“ˆ"},{label:"Task Management",to:"/teamlead/tasks",icon:"ðŸ“‹"},{label:"Shift Extension",to:"/teamlead/shift-extensions",icon:"â±ï¸"},{label:"Lead Approval",to:"/teamlead/lead-approval",icon:"âœ…"}]:[...u,...v,{label:"Team Management",to:"/teamlead/team",icon:"ðŸ‘¥"},{label:"Team Attendance",to:"/teamlead/attendance",icon:"ðŸ•’"},{label:"Task Management",to:"/teamlead/tasks",icon:"ðŸ“‹"},{label:"Shift Extension",to:"/teamlead/shift-extensions",icon:"â±ï¸"},{label:"Lead Approval",to:"/teamlead/lead-approval",icon:"âœ…"}]})();return s.jsxs("div",{className:"home-container",children:[(()=>{`${((n==null?void 0:n.firstName)||"").trim()} ${((n==null?void 0:n.lastName)||"").trim()}`.trim()||((n==null?void 0:n.name)||"").trim()||n!=null&&n.username&&n.username.split("@")[0]||n!=null&&n.email&&n.email.split("@")[0]})(),s.jsxs("div",{className:"home-grid",children:[s.jsxs("div",{className:"home-card calendar-card",children:[s.jsx("h3",{children:"ðŸ“… Monthly Calendar"}),s.jsx("div",{className:"calendar-layout",children:s.jsx(ue,{value:T,onChange:e=>{z(e),e&&q(e)},activeStartDate:C,onActiveStartDateChange:({activeStartDate:e})=>{e&&q(e)},tileClassName:ce,tileContent:me})}),s.jsxs("div",{className:"calendar-actions",children:[s.jsx("button",{className:"btn-primary",onClick:ge,children:"Today"}),s.jsx("button",{className:"btn-outline",onClick:he,children:"Holidays"}),s.jsx("button",{className:"btn-outline",onClick:pe,children:"Apply Leave"})]}),s.jsx("div",{className:"calendar-legend",children:s.jsxs("div",{className:"calendar-legend-items",children:[s.jsxs("div",{className:"calendar-legend-item",children:[s.jsx("span",{className:"legend-swatch today-tile"}),"Today"]}),s.jsxs("div",{className:"calendar-legend-item",children:[s.jsx("span",{className:"legend-swatch present-tile"}),"Present"]}),s.jsxs("div",{className:"calendar-legend-item",children:[s.jsx("span",{className:"legend-swatch approved-leave-tile"}),"Approved Leave"]}),s.jsxs("div",{className:"calendar-legend-item",children:[s.jsx("span",{className:"legend-swatch holiday-tile"}),"Holiday"]}),s.jsxs("div",{className:"calendar-legend-item",children:[s.jsx("span",{className:"legend-swatch wednesday-off-tile"}),"Weekly Off"]}),s.jsxs("div",{className:"calendar-legend-item",children:[s.jsx("span",{className:"legend-swatch lop-tile"}),"LOP"]})]})})]}),s.jsxs("div",{className:"home-card updates-card",children:[s.jsx("h3",{children:"ðŸ†• Updates"}),(()=>{const e=new Date,r=String(e.getMonth()+1).padStart(2,"0"),i=String(e.getDate()).padStart(2,"0"),m=b(e),o=(()=>{const t=Array.isArray(L)?L:[],S=d=>{if(!d)return null;const p=String(d).trim(),l=p.match(/^(\d{4})-(\d{2})-(\d{2})/);if(l)return{m:l[2],d:l[3]};const D=p.match(/^(\d{2})[\/-](\d{2})[\/-](\d{4})$/);if(D)return{d:D[1],m:D[2]};const w=new Date(p);return isNaN(w.getTime())?null:{m:String(w.getMonth()+1).padStart(2,"0"),d:String(w.getDate()).padStart(2,"0")}};return t.filter(d=>{const p=S(d==null?void 0:d.dateOfBirth);return p&&p.m===r&&p.d===i}).map(d=>{const p=`${String((d==null?void 0:d.firstName)||"").trim()} ${String((d==null?void 0:d.lastName)||"").trim()}`.trim()||(d!=null&&d.email?String(d.email).split("@")[0]:"");return{key:`birthday-${m}-${String((d==null?void 0:d.email)||p)}`,date:m,title:"ðŸŽ‚ Birthday",message:`Happy Birthday ${p}`}})})(),g=new Date;g.setDate(g.getDate()-7);const c=b(g),h=(Array.isArray(Z)?Z:[]).map(t=>({key:(t==null?void 0:t.id)||`${t==null?void 0:t.date}-${t==null?void 0:t.title}`,date:String((t==null?void 0:t.date)||""),title:String((t==null?void 0:t.title)||""),message:String((t==null?void 0:t.message)||""),createdAt:t!=null&&t.createdAt?new Date(t.createdAt):new Date})).filter(t=>t.date&&(t.title||t.message)).filter(t=>t.date>=c).sort((t,S)=>S.date.localeCompare(t.date)),u=[...o,...h].filter(t=>t&&t.date).slice(0,6),v=(E||[]).filter(t=>String(t.date||"")>=m).slice(0,6);return s.jsxs("div",{style:{display:"grid",gap:10},children:[u.length>0?s.jsx("div",{className:"updates-list",children:u.map(t=>s.jsxs("div",{className:"updates-item",children:[s.jsxs("div",{className:"updates-title-row",children:[s.jsx("div",{className:"updates-title",children:t.title}),s.jsx("div",{className:"updates-title-date",children:(()=>{try{console.log("Raw date value:",t.date,"Type:",typeof t.date);const S=new Date,f=String(t.date).trim();console.log("Update date string:",f);const d=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"];let p,l,D;const w=f.match(/^(\d{4})-(\d{1,2})-(\d{1,2})$/);if(w)D=w[1],l=w[2],p=w[3];else{const x=f.match(/^(\d{1,2})-(\d{1,2})-(\d{4})$/);if(x)console.log("Matched DD-MM-YYYY format"),p=x[1],l=x[2],D=x[3];else{const j=f.match(/^(?:[A-Za-z]{3}\s+)?([A-Za-z]{3})\s+(\d{1,2})$/);if(!j)return f;const B=(()=>{try{const a=(t==null?void 0:t.createdAt)instanceof Date?t.createdAt:new Date(t==null?void 0:t.createdAt);return isNaN(a.getTime())?null:String(a.getFullYear())}catch{return null}})();if(!B)return f;const _=j[1],R=j[2],F=parseInt(R,10);if(isNaN(F))return f;const O=d.findIndex(a=>String(a).toLowerCase()===String(_).toLowerCase());return O<0?f:`${d[O]} ${F}, ${B}`}}console.log("Extracted values - Day:",p,"Month:",l,"Year:",D);const k=parseInt(p,10),M=parseInt(l,10);if(isNaN(k)||isNaN(M)||M<1||M>12)return console.warn("Invalid day or month:",{day:p,month:l}),f;const H=`${d[M-1]} ${k}, ${D}`;return console.log("Formatted date:",H),H}catch(S){return console.error("Error formatting date:",S),t.date}})()})]}),s.jsx("div",{className:"updates-message",children:t.message})]},t.key))}):null,v.length>0?s.jsx("ul",{className:"updates-list",children:v.map(t=>s.jsxs("li",{className:"updates-item",children:[s.jsx("span",{className:"updates-date",children:t.date}),s.jsx("span",{className:"updates-text",children:t.name||t.title||"Holiday"})]},`${t.date}-${t.name||t.title||""}`))}):null,u.length===0&&v.length===0?s.jsx("div",{className:"updates-empty",children:"No new updates."}):null]})})()]}),s.jsxs("div",{className:"home-card quick-access",children:[s.jsx("h3",{children:"âš¡ Quick Access"}),s.jsx("div",{className:"quick-links",children:ye.map(e=>s.jsxs("button",{type:"button",className:"quick-link",onClick:()=>W(e.to),"aria-label":e.label,title:e.label,children:[s.jsx("span",{className:"quick-link-icon","aria-hidden":!0,children:e.icon}),s.jsx("span",{className:"quick-tooltip",role:"tooltip",children:e.label})]},e.to))})]})]})]})}export{be as default};

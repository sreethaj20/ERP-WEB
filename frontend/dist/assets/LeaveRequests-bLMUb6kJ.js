import{F as i,E as e}from"./vendor-AZjfysqh.js";import{f as u}from"./date-DAJMpUuB.js";import{u as k}from"./index-CcBKZM2H.js";import"./router-CieCW4vl.js";function T(){const{listAllLeaves:S,reviewLeave:D,deleteLeave:L}=k(),[p,y]=i.useState([]),[h,g]=i.useState(""),[x,f]=i.useState(()=>new Date().toISOString().slice(0,7)),[r,j]=i.useState(!1),N=(t=[])=>t.map(a=>{const n=a.duration!=null&&!isNaN(Number(a.duration)),m=String(a.type||"").toLowerCase().includes("half")||!!(a.partOfDay||a.part_of_day),b=Math.max(1,Math.ceil((new Date(a.to)-new Date(a.from))/(1e3*60*60*24))+1),c=n?Number(a.duration):m?.5:b;return{id:a.id,employeeEmail:a.email,employeeName:a.email,leaveType:a.type||"Leave",startDate:a.from,endDate:a.to,days:c,partOfDay:a.partOfDay||a.part_of_day||void 0,reason:a.reason||"",status:String(a.status||"").toLowerCase(),approvedBy:a.approverEmail||"",approvedAt:a.updatedAt||a.createdAt,createdAt:a.createdAt}}),d=async()=>{try{const t=await S();y(N(t))}catch(t){console.warn("Failed to load leaves",t),y([])}};i.useEffect(()=>{d()},[]),i.useEffect(()=>{const t=setInterval(()=>{d()},5e3);return()=>clearInterval(t)},[]),i.useEffect(()=>{const t=()=>d();try{window.addEventListener("erp-leaves-updated",t)}catch{}return()=>{try{window.removeEventListener("erp-leaves-updated",t)}catch{}}},[]);const v=async(t,a)=>{const n=a==="approved"?"Approved":a==="rejected"?"Rejected":"Pending";try{await D(t,n),await d()}catch(s){alert((s==null?void 0:s.message)||"Failed to update status")}},C=async t=>{if(confirm("Delete this leave request?"))try{await L(t),await d()}catch(a){alert((a==null?void 0:a.message)||"Failed to delete leave")}},z=t=>{switch(t){case"pending":return"#ffa500";case"approved":return"#28a745";case"rejected":return"#dc3545";case"manager_pending":return"#17a2b8";default:return"#6c757d"}},R=t=>{const a=new Date,n=a.getMonth(),s=a.getFullYear(),m=l=>l.getMonth()===n&&l.getFullYear()===s,c=(p||[]).filter(l=>(l.employeeEmail||"").toLowerCase()===(t||"").toLowerCase()&&String(l.status||"").toLowerCase()==="approved"&&m(new Date(String(l.startDate).slice(0,10)))).reduce((l,_)=>l+(Number(_.days)||0),0),w=1.5;return{remaining:Math.max(0,w-c),used:c,allowance:w}},o=i.useMemo(()=>{if(r)return[];const t=h.toLowerCase(),a=s=>{try{return String(new Date(s).toISOString()).slice(0,7)===x}catch{return!0}},n=p.filter(s=>s.status==="pending"||s.status==="manager_pending"||s.status==="admin_pending"||s.status==="approved"||s.status==="rejected").filter(s=>a(s.startDate));return t?n.filter(s=>[s.employeeName,s.employeeEmail,s.leaveType,s.reason,s.status].join(" ").toLowerCase().includes(t)):n},[p,h,x,r]),E=o.filter(t=>t.status==="pending"||t.status==="manager_pending"||t.status==="admin_pending").length,A=o.filter(t=>t.status==="approved").length,M=o.filter(t=>t.status==="rejected").length;return e.jsxs("div",{className:"dashboard fade-in",children:[e.jsx("h2",{children:"ðŸ–ï¸ Leave Requests Management"}),e.jsxs("div",{className:"dashboard-grid",style:{marginBottom:"16px",gap:"12px",gridTemplateColumns:"repeat(auto-fit, minmax(180px, 1fr))"},children:[e.jsxs("div",{className:"dashboard-card",style:{background:"#fff3cd",padding:"14px",borderRadius:"10px"},children:[e.jsx("h3",{style:{color:"#856404",fontSize:"16px",marginBottom:"6px"},children:"â³ Pending"}),e.jsx("p",{style:{fontSize:"18px",fontWeight:"bold",color:"#856404",margin:0},children:E})]}),e.jsxs("div",{className:"dashboard-card",style:{background:"#d4edda",padding:"14px",borderRadius:"10px"},children:[e.jsx("h3",{style:{color:"#155724",fontSize:"16px",marginBottom:"6px"},children:"âœ… Approved"}),e.jsx("p",{style:{fontSize:"18px",fontWeight:"bold",color:"#155724",margin:0},children:A})]}),e.jsxs("div",{className:"dashboard-card",style:{background:"#f8d7da",padding:"14px",borderRadius:"10px"},children:[e.jsx("h3",{style:{color:"#721c24",fontSize:"16px",marginBottom:"6px"},children:"âŒ Rejected"}),e.jsx("p",{style:{fontSize:"18px",fontWeight:"bold",color:"#721c24",margin:0},children:M})]})]}),e.jsxs("div",{style:{display:"flex",gap:12,marginBottom:12,flexWrap:"wrap"},children:[e.jsx("input",{placeholder:"Search by employee name, email, leave type...",value:h,onChange:t=>g(t.target.value),style:{maxWidth:360}}),e.jsxs("div",{style:{display:"flex",alignItems:"center",gap:8},children:[e.jsx("label",{style:{fontSize:12,color:"#555"},children:"Month:"}),e.jsx("input",{type:"month",value:x,onChange:t=>f(t.target.value)})]}),e.jsx("button",{type:"button",className:"btn-outline",onClick:()=>{if(r){j(!1),d();try{console.debug("Admin LeaveRequests: table restored")}catch{}}else{g(""),f(new Date().toISOString().slice(0,7)),j(!0);try{console.debug("Admin LeaveRequests: table cleared (UI only)")}catch{}}},children:r?"Show Data":"Clear Table"})]}),e.jsx("div",{className:"table-wrapper",children:e.jsxs("table",{className:"leave-requests-table",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{style:{width:"90px"},children:"Submitted"}),e.jsx("th",{style:{width:"180px"},children:"Employee & Leaves"}),e.jsx("th",{style:{width:"100px"},children:"Leave Type"}),e.jsx("th",{style:{width:"90px"},children:"Start Date"}),e.jsx("th",{style:{width:"90px"},children:"End Date"}),e.jsx("th",{style:{width:"60px"},children:"Days"}),e.jsx("th",{style:{width:"200px"},children:"Reason"}),e.jsx("th",{style:{width:"100px"},children:"Status"}),e.jsx("th",{style:{width:"100px"},children:"Manager"}),e.jsx("th",{style:{width:"120px"},children:"Actions"})]})}),e.jsx("tbody",{children:o.length===0?e.jsx("tr",{children:e.jsx("td",{colSpan:"10",style:{textAlign:"center"},children:"No leave requests found."})}):o.map(t=>e.jsxs("tr",{children:[e.jsx("td",{style:{fontSize:"12px"},children:u(t.createdAt)}),e.jsx("td",{children:e.jsxs("div",{style:{lineHeight:"1.3"},children:[e.jsx("strong",{style:{fontSize:"13px"},children:t.employeeName}),e.jsx("br",{}),(()=>{const a=R(t.employeeEmail),n=a.remaining===0?"#dc3545":a.remaining===1?"#ffa500":"#28a745";return e.jsxs("small",{style:{color:n,fontSize:"11px",fontWeight:"600",display:"flex",alignItems:"center",gap:"4px"},children:[e.jsx("span",{children:"ðŸ“…"}),a.remaining," leaves left this month",e.jsxs("span",{style:{color:"#666",fontWeight:"400"},children:["(",a.used,"/",a.allowance," used)"]})]})})()]})}),e.jsx("td",{children:e.jsxs("div",{style:{display:"flex",flexDirection:"column",gap:2},children:[e.jsx("span",{className:"leave-type-badge",style:{backgroundColor:"#e3f2fd",color:"#1976d2",padding:"2px 6px",borderRadius:"12px",fontSize:"11px",fontWeight:"500",width:"fit-content"},children:t.leaveType}),Number(t.days)===.5&&e.jsxs("small",{style:{color:"#555"},children:["Half Day ",t.partOfDay?`(${t.partOfDay})`:""]})]})}),e.jsx("td",{style:{fontSize:"12px"},children:u(t.startDate)}),e.jsx("td",{style:{fontSize:"12px"},children:u(t.endDate)}),e.jsx("td",{style:{textAlign:"center"},children:e.jsx("strong",{style:{fontSize:"14px",color:"#1976d2"},children:t.days})}),e.jsx("td",{style:{fontSize:"12px",maxWidth:"200px",wordWrap:"break-word"},children:t.reason}),e.jsx("td",{children:e.jsx("span",{className:"status-badge",style:{backgroundColor:z(t.status),color:"white",textTransform:"capitalize",padding:"4px 8px",borderRadius:"4px",fontSize:"11px",fontWeight:"500"},children:t.status.replace("_"," ")})}),e.jsx("td",{style:{fontSize:"12px"},children:t.projectManager||t.approvedBy||"-"}),e.jsx("td",{children:e.jsxs("div",{style:{display:"flex",gap:4,flexDirection:"column",alignItems:"stretch"},children:[(t.status==="pending"||t.status==="manager_pending"||t.status==="admin_pending")&&e.jsxs(e.Fragment,{children:[e.jsx("button",{className:"btn-primary",onClick:()=>v(t.id,"approved"),style:{fontSize:"10px",padding:"3px 6px",minHeight:"24px"},children:"Approve"}),e.jsx("button",{className:"btn-outline",onClick:()=>v(t.id,"rejected"),style:{fontSize:"10px",padding:"3px 6px",minHeight:"24px"},children:"Reject"})]}),e.jsx("button",{className:"btn-outline",onClick:()=>C(t.id),style:{fontSize:"10px",padding:"3px 6px",minHeight:"24px",color:"#dc3545"},children:"Delete"})]})})]},t.id))})]})})]})}export{T as default};

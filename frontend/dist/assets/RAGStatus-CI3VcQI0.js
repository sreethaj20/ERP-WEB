import{M as st,F as l,E as e}from"./vendor-AZjfysqh.js";import{u as at,b as nt}from"./index-CcBKZM2H.js";import"./router-CieCW4vl.js";function pt(){const{users:g,currentUser:o,createRagReport:J,createOneOnOne:P,getOneOnOneByMonth:C,getRagByMonth:D}=at(),{addNotification:N}=nt(),K=st(),[A,z]=l.useState([]),[ot,u]=l.useState([]),[m,O]=l.useState({}),[b,v]=l.useState({}),[x,f]=l.useState({}),[w,S]=l.useState(!1),[r,W]=l.useState(""),[p,L]=l.useState("rag"),[it,Y]=l.useState([]),[rt,lt]=l.useState({email:"",date:"",notes:"",actions:"",status:"Planned"}),[dt,ct]=l.useState(null),[mt,ht]=l.useState({email:"",date:"",notes:"",actions:"",status:"Planned"}),T=t=>String(t||"").toLowerCase().split(" ").filter(Boolean).map(n=>n.charAt(0).toUpperCase()+n.slice(1)).join(" "),k=t=>{const n=(t==null?void 0:t.empId)||(t==null?void 0:t.empID)||(t==null?void 0:t.employeeId)||(t==null?void 0:t.employeeID)||(t==null?void 0:t.emp_id);if(n)return String(n).toUpperCase();const a=(t==null?void 0:t.email)||(t==null?void 0:t.id)||"";return String(a).split("@")[0].toUpperCase()},[R,j]=l.useState({}),[M,E]=l.useState({}),_=((o==null?void 0:o.email)||"unknown").toLowerCase(),h=(t,n=r)=>`${t}_${n}_${_}`,H=((o==null?void 0:o.designation)||"").toLowerCase()==="team lead",V=g.some(t=>(t.teamLeadEmail||"").toLowerCase()===((o==null?void 0:o.email)||"").toLowerCase()),I=H||V,q=g.filter(t=>(t.role||"").toLowerCase()==="employee"&&(t.teamLeadEmail||"").toLowerCase()===((o==null?void 0:o.email)||"").toLowerCase()),B=()=>{const t=new Date,n=t.getDate(),a=t.getFullYear(),s=t.getMonth();if(n>=15)return`${a}-${String(s+1).padStart(2,"0")}`;{const d=s===0?11:s-1;return`${s===0?a-1:a}-${String(d+1).padStart(2,"0")}`}};l.useEffect(()=>{const t=B();W(t),Q(),O({}),v({}),f({}),S(!1),Y([]),j({}),E({})},[g,I,o]),l.useEffect(()=>{(async()=>{if(!r){u([]);return}try{const n=await C(r),a=(Array.isArray(n)?n:[]).filter(i=>(i.manager||"").toLowerCase()===((o==null?void 0:o.email)||"").toLowerCase());u(a);const s={},d={};a.forEach(i=>{const c=(i.email||"").toLowerCase();s[c]=!0,i.comments&&(d[c]=i.comments)}),E(s),j(i=>({...i,...d}))}catch{u([])}})()},[r,o,C]),l.useEffect(()=>{(async()=>{if(r)try{const n=await D(r),a=(Array.isArray(n)?n:[]).filter(c=>(c.manager||"").toLowerCase()===((o==null?void 0:o.email)||"").toLowerCase()),s={},d={...m},i={...b};a.forEach(c=>{const y=(c.email||"").toLowerCase();s[y]=!0,c.status&&(d[y]=c.status),c.comments&&(i[y]=c.comments)}),f(s),O(d),v(i),S(!1)}catch{}})()},[r,o,D]);const Q=()=>{const t=g.filter(s=>(s.role||"").toLowerCase()==="employee"),a=(I?t.filter(s=>(s.teamLeadEmail||"").toLowerCase()===((o==null?void 0:o.email)||"").toLowerCase()):[]).map(s=>({id:s.email,empId:k(s),empName:`${s.firstName||""} ${s.lastName||""}`.trim()||s.username||s.email.split("@")[0],empRole:s.designation||s.position||s.role||"Employee",comments:""}));z(a),localStorage.setItem(h("oneOnOneData",B()),JSON.stringify(a))},X=(t,n)=>{const a={...R,[t]:n};j(a),r&&localStorage.setItem(h("ooComments",r),JSON.stringify(a))},Z=async t=>{const n={...M,[t]:!0};E(n),r&&localStorage.setItem(h("ooSubmitted",r),JSON.stringify(n));const a=R[t]||"";j(s=>({...s,[t]:a}));try{await P({email:t,comments:a,month:r});const s=await C(r),d=(Array.isArray(s)?s:[]).filter(i=>(i.manager||"").toLowerCase()===((o==null?void 0:o.email)||"").toLowerCase());u(d);try{const i=g.find(y=>(y.email||"").toLowerCase()===(t||"").toLowerCase()),c=`${(i==null?void 0:i.firstName)||""} ${(i==null?void 0:i.lastName)||""}`.trim()||(i==null?void 0:i.username)||t;N({title:"1:1 Submitted",message:`Submitted 1:1 for ${c}`,type:"success",link:"/teamlead/rag",audience:`user:${((o==null?void 0:o.email)||"").toLowerCase()}`})}catch{}}catch(s){alert((s==null?void 0:s.message)||"Failed to submit 1:1")}},$=(t,n)=>{if(w||x[t])return;const a={...m,[t]:n};O(a),r&&localStorage.setItem(h("ragEmployeeStatus"),JSON.stringify(a))},U=(t,n)=>{if(w||x[t])return;const a={...b,[t]:n};v(a),r&&localStorage.setItem(h("ragComments"),JSON.stringify(a))},F=async t=>{if(!r)return;const n=t.map(a=>({...a,month:r,comments:a.comments||""}));await Promise.all(n.map(a=>J({email:a.email,status:a.status,comments:a.comments,month:a.month})))},tt=async t=>{if(!m[t]){alert("Please select Red/Amber/Green before submitting.");return}if(x[t])return;const n=[{email:t,status:m[t],comments:b[t]||""}];try{await F(n)}catch(s){alert((s==null?void 0:s.message)||"Failed to submit");return}const a={...x,[t]:!0};f(a),r&&localStorage.setItem(h("ragSubmittedRows"),JSON.stringify(a)),S(!1),r&&localStorage.setItem(h("ragOverallSubmitted"),JSON.stringify(!1));try{const s=g.find(i=>(i.email||"").toLowerCase()===(t||"").toLowerCase()),d=`${(s==null?void 0:s.firstName)||""} ${(s==null?void 0:s.lastName)||""}`.trim()||(s==null?void 0:s.username)||t;N({title:"RAG Submitted",message:`RAG ${m[t]} submitted for ${d}`,type:"success",link:"/teamlead/rag",audience:`user:${((o==null?void 0:o.email)||"").toLowerCase()}`})}catch{}},et=async()=>{const t=A.map(s=>s.id).filter(s=>!x[s]&&m[s]);if(t.length===0){alert("No pending rows with a selected status to submit.");return}const n=t.map(s=>({email:s,status:m[s],comments:b[s]||""}));try{await F(n)}catch(s){alert((s==null?void 0:s.message)||"Failed to submit all");return}const a={...x};A.forEach(s=>{a[s.id]=!0}),f(a),r&&localStorage.setItem(h("ragSubmittedRows"),JSON.stringify(a)),S(!0),r&&localStorage.setItem(h("ragOverallSubmitted"),JSON.stringify(!0));try{N({title:"RAG: Submitted All",message:`Submitted ${t.length} rows to Admin`,type:"success",link:"/teamlead/rag",audience:`user:${((o==null?void 0:o.email)||"").toLowerCase()}`})}catch{}},G=()=>{K("/teamlead/performance")};return I?e.jsxs("div",{className:"dashboard fade-in",children:[e.jsxs("div",{className:"dashboard-header",children:[e.jsxs("div",{children:[e.jsx("h2",{children:"ğŸš¦ Connections"}),e.jsxs("p",{children:["Current month: ",r]})]}),e.jsx("button",{className:"btn-outline back-to-dashboard",onClick:G,children:"â† Back to Team Performance"})]}),e.jsxs("div",{style:{display:"flex",gap:8,marginBottom:12},children:[e.jsx("button",{className:p==="rag"?"btn-primary":"btn-outline",onClick:()=>L("rag"),type:"button",children:"RAG Matrix"}),e.jsx("button",{className:p==="interactions"?"btn-primary":"btn-outline",onClick:()=>L("interactions"),type:"button",children:"1:1 Interactions"}),((o==null?void 0:o.role)||"").toLowerCase()==="admin"&&e.jsx("button",{className:p==="reports"?"btn-primary":"btn-outline",onClick:()=>L("reports"),type:"button",children:"Reports"})]}),p==="rag"&&e.jsxs("div",{className:"one-on-one-container",children:[e.jsx("div",{className:"table-wrapper",children:e.jsxs("table",{className:"one-on-one-table",children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{children:"Emp ID"}),e.jsx("th",{children:"Emp Name"}),e.jsx("th",{children:"Designation"}),e.jsx("th",{children:"Red"}),e.jsx("th",{children:"Amber"}),e.jsx("th",{children:"Green"}),e.jsx("th",{children:"Comments"}),e.jsx("th",{children:"Submit"})]})}),e.jsx("tbody",{children:A.map(t=>{const n=m[t.id],a=w||x[t.id],s=g.find(i=>(i.email||"").toLowerCase()===(t.id||"").toLowerCase()),d=k(s||{id:t.id,email:t.id});return e.jsxs("tr",{style:{borderBottom:"#e5e7eb 1px solid"},children:[e.jsx("td",{style:{padding:"8px 10px",verticalAlign:"middle"},children:d}),e.jsx("td",{style:{padding:"8px 10px",verticalAlign:"middle"},children:t.empName}),e.jsx("td",{style:{padding:"8px 10px",verticalAlign:"middle"},children:e.jsx("span",{style:{fontWeight:500},children:T(t.empRole)})}),e.jsx("td",{onClick:()=>$(t.id,"red"),style:{cursor:a?"not-allowed":"pointer",textAlign:"center",background:n==="red"?"#FEE2E2":"transparent",color:n==="red"?"#B91C1C":void 0},title:a?"Submitted":"Mark Red (Critical)",children:"ğŸ”´"}),e.jsx("td",{onClick:()=>$(t.id,"amber"),style:{cursor:a?"not-allowed":"pointer",textAlign:"center",background:n==="amber"?"#FEF3C7":"transparent",color:n==="amber"?"#92400E":void 0},title:a?"Submitted":"Mark Amber (At Risk)",children:"ğŸŸ¡"}),e.jsx("td",{onClick:()=>$(t.id,"green"),style:{cursor:a?"not-allowed":"pointer",textAlign:"center",background:n==="green"?"#DCFCE7":"transparent",color:n==="green"?"#065F46":void 0},title:a?"Submitted":"Mark Green (On Track)",children:"ğŸŸ¢"}),e.jsx("td",{style:{padding:"8px 10px"},children:e.jsx("textarea",{className:"comment-textarea",rows:2,value:b[t.id]||"",onChange:i=>U(t.id,i.target.value),placeholder:"Add comment...",disabled:a})}),e.jsx("td",{style:{textAlign:"center",padding:"8px 10px",verticalAlign:"middle"},children:e.jsx("button",{className:"btn-primary",onClick:()=>tt(t.id),disabled:a||!m[t.id],title:a?"Already submitted":"Submit row to Admin",children:"Submit"})})]},`rag-${t.id}`)})})]})}),e.jsx("div",{className:"one-on-one-actions",children:e.jsx("button",{className:"btn-primary btn-submit",onClick:et,disabled:w,children:"Submit All to Admin"})})]}),p==="interactions"&&e.jsxs("div",{className:"dashboard-card",style:{padding:12},children:[e.jsx("h3",{style:{marginTop:0},children:"1:1 Interactions"}),e.jsx("div",{className:"table-wrapper",children:e.jsxs("table",{className:"user-table",style:{width:"100%",tableLayout:"fixed",borderCollapse:"separate",borderSpacing:0},children:[e.jsx("thead",{children:e.jsxs("tr",{children:[e.jsx("th",{style:{width:"12%"},children:"Emp ID"}),e.jsx("th",{style:{width:"22%"},children:"Emp Name"}),e.jsx("th",{style:{width:"18%"},children:"Designation"}),e.jsx("th",{style:{textAlign:"left",width:"36%"},children:"Comments"}),e.jsx("th",{style:{width:"12%"},children:"Submit"})]})}),e.jsx("tbody",{children:q.map(t=>{const n=t.email,a=k(t),s=`${t.firstName||""} ${t.lastName||""}`.trim()||t.username||a,d=t.designation||t.role||"Employee",i=!!M[n];return e.jsxs("tr",{style:{borderBottom:"#e5e7eb 1px solid"},children:[e.jsx("td",{style:{verticalAlign:"middle",whiteSpace:"nowrap",padding:"8px 10px"},children:a}),e.jsx("td",{style:{verticalAlign:"middle",wordBreak:"break-word",padding:"8px 10px"},children:s}),e.jsx("td",{style:{verticalAlign:"middle",padding:"8px 10px"},children:e.jsx("span",{style:{fontWeight:500},children:T(d)})}),e.jsx("td",{style:{textAlign:"left",verticalAlign:"middle",overflow:"hidden",padding:"8px 10px"},children:e.jsx("textarea",{rows:2,placeholder:"Add one-on-one comments...",value:R[n]||"",onChange:c=>X(n,c.target.value),disabled:i,className:"comment-textarea",style:{display:"block",width:"100%",maxWidth:"100%",boxSizing:"border-box",resize:"vertical",minHeight:64,margin:0,padding:"6px 8px"}})}),e.jsx("td",{style:{textAlign:"center",verticalAlign:"middle",padding:"8px 10px"},children:e.jsx("button",{className:"btn-primary",type:"button",onClick:()=>Z(n),disabled:i,children:i?"Submitted":"Submit"})})]},`oo-${n}`)})})]})})]})]}):e.jsxs("div",{className:"dashboard fade-in",style:{padding:20},children:[e.jsxs("div",{className:"dashboard-header",children:[e.jsxs("div",{children:[e.jsx("h2",{children:"ğŸš¦ Employee RAG Matrix"}),e.jsx("p",{children:"Only Team Leads can view and submit RAG for their team."})]}),e.jsx("button",{className:"btn-outline back-to-dashboard",onClick:G,children:"â† Back to Team Performance"})]}),e.jsx("div",{className:"card",style:{padding:16,marginTop:12},children:e.jsx("p",{style:{margin:0},children:"You are not assigned as a Team Lead or do not have any direct reports yet."})})]})}export{pt as default};
